<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data:; script-src 'self' 'unsafe-inline' blob: data:; worker-src 'self' blob:;" />
    <title>Electron Starter</title>
    <link rel="stylesheet" href="video_booth/video_booth.css">
  </head>
  <body>
    <div class="canvas-wrap">
      <canvas id="board"></canvas>
    </div>

    <script type="module" src="ui-bootstrap.js"></script>
    <style>
      :root{
        --ls-font-size-base: 16px;
        --ls-line-height: 1.5;
        --ls-ease: cubic-bezier(0.2, 0, 0, 1);
        --ls-theme-dur: 200ms;
        --ls-press-dur: 100ms;
        --ls-motion-dur: 250ms;
        --ls-motion-ease: cubic-bezier(0.4, 0.0, 0.2, 1);
        --ls-radius-sm: 10px;
        --ls-radius-md: 14px;
        --ls-radius-lg: 18px;
        --accent: var(--ls-sys-color-primary);

        --ls-mica-strength: 0.60;
        --ls-mica-blur: 14.40px;
        --ls-mica-feather: 8px;
        --ls-mica-overlay: 0.30;
        --ls-mica-saturation: 1.2;

        --ls-sys-color-primary: #005ac1;
        --ls-sys-color-on-primary: #ffffff;
        --ls-sys-color-secondary: #535f70;
        --ls-sys-color-on-secondary: #ffffff;
        --ls-sys-color-tertiary: #6c5dd3;
        --ls-sys-color-on-tertiary: #ffffff;
        --ls-sys-color-error: #b3261e;
        --ls-sys-color-on-error: #ffffff;
        --ls-sys-color-surface: #fdfbff;
        --ls-sys-color-on-surface: #1a1c1e;
        --ls-sys-color-background: #ffffff;
        --ls-sys-color-outline: #73777f;

        --primary-container: #d6e3ff;
        --on-primary-container: #001b3d;
        --secondary-container: #d7e3f8;
        --on-secondary-container: #101c2b;
        --surface-container-lowest: var(--ls-sys-color-surface);
        --ls-elev0-overlay: rgba(0,0,0,0.05);

        --ls-dark-surface: #121212;
        --ls-dark-on-surface: #FFFFFF;
        --ls-dark-hover-overlay: rgba(255,255,255,0.10);
        --ls-dark-press-overlay: rgba(255,255,255,0.14);

        --ls-fluent-btn-bg: rgba(255,255,255,0.86);
        --ls-fluent-btn-fg: var(--ls-sys-color-on-surface);
        --ls-fluent-btn-border: rgba(0,0,0,0.12);
        --ls-fluent-btn-hover-shadow: 0 6px 16px rgba(0,0,0,0.12);
        --ls-fluent-btn-active-bg: rgba(43,124,255,0.14);
        --ls-fluent-btn-active-border: rgba(43,124,255,0.45);

        --ls-tool-size: 3rem;
        --ls-tool-ink-size: max(3rem, calc(var(--ls-tool-size) * 1.5));

        --md-sys-color-primary: var(--ls-sys-color-primary);
        --md-sys-color-on-primary: var(--ls-sys-color-on-primary);
        --md-sys-color-secondary: var(--ls-sys-color-secondary);
        --md-sys-color-on-secondary: var(--ls-sys-color-on-secondary);
        --md-sys-color-surface: var(--ls-sys-color-surface);
        --md-sys-color-on-surface: var(--ls-sys-color-on-surface);
        --md-sys-color-outline: var(--ls-sys-color-outline);
        
        --text-high: rgba(0,0,0,0.87);
        --text-medium: rgba(0,0,0,0.60);
        --text-disabled: rgba(0,0,0,0.38);
      }
      html.dl-fluent{
        --ls-font-size-base: 15px;
        --ls-line-height: 1.45;
        --ls-ease: cubic-bezier(0.2, 0, 0, 1);
        --ls-theme-dur: 180ms;
        --ls-radius-sm: 10px;
        --ls-radius-md: 14px;
        --ls-radius-lg: 18px;
      }
      html.dl-md3{
        --ls-font-size-base: 16px;
        --ls-line-height: 1.5;
        --ls-ease: cubic-bezier(0.2, 0, 0, 1);
        --ls-theme-dur: 200ms;
        --ls-motion-dur: 250ms;
        --ls-motion-ease: cubic-bezier(0.4, 0.0, 0.2, 1);
        --ls-radius-sm: 12px;
        --ls-radius-md: 16px;
        --ls-radius-lg: 28px;
      }
      html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";font-size:var(--ls-font-size-base);line-height:var(--ls-line-height);background:transparent;color: var(--text-high);transition: background-color var(--ls-theme-dur) var(--ls-ease), color var(--ls-theme-dur) var(--ls-ease);}
      body{
        transition: opacity 150ms ease-out, transform 150ms ease-out;
      }
      body.mode-switching {
        opacity: 0.8;
        transform: scale(0.995);
        pointer-events: none !important;
      }
      .canvas-wrap{height:100%;background:transparent;display:flex}
      body[data-app-mode="whiteboard"] .canvas-wrap{background:#ffffff}
      
      html.dl-fluent .md3-button{
        padding:12px 12px;
        border-radius:var(--ls-radius-sm);
        border:1px solid rgba(0,0,0,0.12);
        background:rgba(255,255,255,0.86);
        cursor:pointer;
        min-height:48px;
        touch-action:manipulation;
        -webkit-user-select:none;
        user-select:none;
        text-align:left;
        color:var(--ls-sys-color-on-surface);
        transition:transform var(--ls-press-dur) var(--ls-ease), box-shadow var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease), border-color var(--ls-theme-dur) var(--ls-ease);
        position:relative;
        overflow:hidden
      }
      html.dl-fluent .md3-button:hover{box-shadow:0 6px 16px rgba(0,0,0,0.12)}
      html.dl-fluent .md3-button:active{transform:scale(0.95)}
      html.dl-fluent .md3-button:disabled{opacity:0.6;filter:grayscale(1);cursor:default;pointer-events:none}

      html.dl-md3 .md3-button{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        padding:0 24px;
        height:48px;
        border-radius:20px;
        font-size:16px;
        font-weight:600;
        letter-spacing:0.1px;
        cursor:pointer;
        border:none;
        transition:transform var(--ls-press-dur) var(--ls-ease), box-shadow var(--ls-theme-dur) var(--ls-ease), filter var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease), color var(--ls-theme-dur) var(--ls-ease);
        gap:8px;
        user-select:none;
        position:relative;
        overflow:hidden
      }
      html.dl-md3 .md3-button.filled{background-color:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary)}
      html.dl-md3 .md3-button.filled:hover{box-shadow:0 4px 12px rgba(0,0,0,0.20);filter:brightness(1.03)}
      html.dl-md3 .md3-button:active{transform:scale(0.95)}
      html.dl-md3 .md3-button.tonal{background-color:var(--md-sys-color-secondary);color:var(--md-sys-color-on-secondary);opacity:0.8}
      html.dl-md3 .md3-button.text{background:transparent;color:var(--md-sys-color-primary);padding:0 12px}
      html.dl-md3 .md3-button.text:hover{background:rgba(0, 90, 193, 0.08)}
      html.dl-md3 .md3-button:disabled{opacity:0.6;filter:grayscale(1);cursor:default;pointer-events:none}

      #board{flex:1;display:block;width:100%;height:100%;touch-action:none;background:transparent}
      .floating-panel{
        position:fixed;
        right:1.25rem;
        top:5rem;
        width:auto;
        min-width:4rem;
        max-width:min(calc(100vw - 2.5rem), 36rem);
        border-radius:var(--ls-radius-lg);
        padding:0.75rem;
        background:var(--ls-fluent-btn-bg);
        border:1px solid var(--ls-fluent-btn-border);
        box-shadow:0 10px 24px rgba(0,0,0,0.12);
        z-index:3000;
        display:flex;
        flex-direction:column;
        gap:0.625rem;
        align-items:flex-start;
        transition:width var(--ls-motion-dur) var(--ls-motion-ease),border-radius var(--ls-motion-dur) var(--ls-motion-ease),background-color var(--ls-motion-dur) var(--ls-motion-ease),border-color var(--ls-motion-dur) var(--ls-motion-ease),box-shadow var(--ls-motion-dur) var(--ls-motion-ease);
      }
      .floating-panel .panel-section{width:auto;display:flex;gap:0.5rem;align-items:center;justify-content:flex-start;flex-wrap:nowrap}
      .floating-panel .tools{justify-content:flex-start}
      .tool{position:relative}
      .tool-btn{
        width:var(--ls-tool-size);
        height:var(--ls-tool-size);
        border-radius:var(--ls-radius-sm);
        border:1px solid var(--ls-fluent-btn-border);
        background:var(--ls-fluent-btn-bg);
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        touch-action:manipulation;
        -webkit-user-select:none;
        user-select:none;
        color:var(--ls-fluent-btn-fg);
        box-shadow:none;
        transition:transform var(--ls-press-dur) var(--ls-motion-ease),background-color var(--ls-motion-dur) var(--ls-motion-ease),color var(--ls-motion-dur) var(--ls-motion-ease),border-color var(--ls-motion-dur) var(--ls-motion-ease),box-shadow var(--ls-motion-dur) var(--ls-motion-ease);
        position:relative;
        overflow:hidden;
      }
      .tool-btn:active{transform:scale(0.95)}
      .tool-btn[disabled]{opacity:0.6;filter:grayscale(1);cursor:default;pointer-events:none}
      html.dl-fluent .tool-btn:hover,html.dl-fluent .tool-btn:focus-visible{box-shadow:var(--ls-fluent-btn-hover-shadow)}
      html.dl-fluent .tool-btn.active{background:var(--ls-fluent-btn-active-bg);border-color:var(--ls-fluent-btn-active-border)}

      html.dl-md3 .floating-panel{
        background:var(--surface-container-lowest);
        border:none;
        box-shadow:none;
      }
      html.dl-md3 .tool-btn{
        border:none;
        background:var(--surface-container-lowest);
        color:var(--ls-sys-color-on-surface);
        box-shadow:none;
        opacity:0.6;
        transition:transform var(--ls-press-dur) var(--ls-motion-ease),opacity var(--ls-motion-dur) var(--ls-motion-ease),background-color var(--ls-motion-dur) var(--ls-motion-ease),color var(--ls-motion-dur) var(--ls-motion-ease);
      }
      html.dl-md3 .tool-btn::before{
        content:'';
        position:absolute;
        inset:0;
        border-radius:inherit;
        background:var(--ls-elev0-overlay);
        opacity:0;
        transition:opacity var(--ls-motion-dur) var(--ls-motion-ease);
        pointer-events:none;
      }
      html.dl-md3 .tool-btn:hover::before,html.dl-md3 .tool-btn:focus-visible::before{opacity:1}
      @keyframes lsInkSpring{
        0%{transform:translate(-50%,-50%) scale(0);opacity:0}
        60%{transform:translate(-50%,-50%) scale(1.08);opacity:1}
        100%{transform:translate(-50%,-50%) scale(1);opacity:1}
      }
      html.dl-md3 .tool-btn::after{
        content:'';
        position:absolute;
        left:50%;
        top:50%;
        width:var(--ls-tool-ink-size);
        height:var(--ls-tool-ink-size);
        border-radius:999px;
        background:var(--secondary-container);
        transform:translate(-50%,-50%) scale(0);
        opacity:0;
        transition:transform var(--ls-motion-dur) var(--ls-motion-ease),opacity var(--ls-motion-dur) var(--ls-motion-ease);
        pointer-events:none;
      }
      html.dl-md3 .tool-btn.active,html.dl-md3 .tool-btn.ink-visible{opacity:1}
      html.dl-md3 .tool-btn.active::after,html.dl-md3 .tool-btn.ink-visible::after{transform:translate(-50%,-50%) scale(1);opacity:1}
      html.dl-md3 .tool-btn.active::after{animation:lsInkSpring 500ms}
      html.dl-switching .floating-panel,html.dl-switching .tool-btn,html.dl-switching .submenu,html.dl-switching .mode-btn{transition-duration:1ms !important}
      body[data-pdf-mode="1"] .floating-panel{
        border-color:#e53935;
        box-shadow:0 12px 28px rgba(229,57,53,0.44);
      }
      body[data-pdf-mode="1"] .tool-btn.active{
        color:#e53935;
      }
      /* 子菜单为固定排版：固定宽度，自适应高度包含所有控件 */
      .submenu{position:absolute;right:0;top:48px;background:rgba(255,255,255,0.97);padding:0;border-radius:18px;box-shadow:0 8px 22px rgba(0,0,0,0.12);display:none;z-index:2500;width:min(240px,calc(100vw - 40px));max-width:calc(100vw - 40px);box-sizing:border-box;transition:top 0.3s cubic-bezier(0.25,0.46,0.45,0.94),opacity 0.3s ease;flex-direction:column;overflow:hidden}
      .submenu.open{display:flex}
      .submenu .submenu-content{display:flex;min-width:0}
      .submenu .submenu-quick{width:72px;flex:0 0 72px;padding:12px 10px 12px 12px;box-sizing:border-box;border-right:1px solid #e5e5e5;background:rgba(0,0,0,0.02);display:flex;align-items:flex-start;justify-content:flex-start}
      .submenu .submenu-quick-grid{display:grid;grid-template-columns:1fr;grid-auto-rows:min-content;gap:8px;justify-items:start;align-content:start;width:100%}
      .submenu .submenu-quick-grid .tool-btn svg,.submenu .submenu-quick-grid .tool-btn img{width:22px;height:22px}
      .submenu .submenu-quick-grid .tool-btn i{font-size:22px;line-height:22px}
      .submenu .submenu-body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1;min-width:0}
      .submenu .submenu-pin{border:1px solid rgba(0,0,0,0.12);background:rgba(255,255,255,0.86);padding:12px 12px;border-radius:var(--ls-radius-sm);cursor:pointer;min-height:48px;touch-action:manipulation;-webkit-user-select:none;user-select:none;transition:transform var(--ls-press-dur) var(--ls-ease), box-shadow var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease);position:relative;overflow:hidden}
      .submenu .submenu-footer{display:flex;justify-content:flex-end;gap:8px;padding:8px 12px;border-top:1px solid #e5e5e5;background:rgba(255,255,255,0.5)}
      .submenu .submenu-drag-handle{border:1px solid rgba(0,0,0,0.12);background:rgba(255,255,255,0.86);padding:12px 12px;border-radius:var(--ls-radius-sm);cursor:grab;min-height:48px;touch-action:none;-webkit-user-select:none;user-select:none;transition:box-shadow var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease)}
      .submenu.colors{width:min(240px,calc(100vw - 40px));max-width:calc(100vw - 40px);box-sizing:border-box}
      .submenu#moreMenu{width:min(560px,calc(100vw - 40px))}
      .submenu#moreMenu .submenu-content.more-split{display:flex;align-items:stretch;min-width:0}
      .submenu#moreMenu .more-region{display:flex;flex-direction:column;min-width:0;flex:1}
      .submenu#moreMenu .more-title{font-size:13px;font-weight:800;color:rgba(0,0,0,0.66);padding:10px 12px 8px}
      .submenu#moreMenu .submenu-quick{width:auto;flex:0 0 auto;padding:10px 12px 12px;border-right:none;background:transparent}
      .submenu#moreMenu .submenu-quick-grid{grid-template-columns:repeat(auto-fill,minmax(48px,1fr));grid-auto-rows:48px;justify-items:stretch}
      .submenu#moreMenu .submenu-quick-grid .tool-btn{width:48px;height:48px;position:relative}
      .submenu#moreMenu .submenu-quick-grid .tool-btn[data-feature-category]::after {
        content: '';
        position: absolute;
        top: 4px;
        right: 4px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #2b7cff;
        border: 1px solid #fff;
      }
      .submenu#moreMenu .submenu-quick-grid .tool-btn[data-feature-category="utility"]::after { background: #34c759; }
      .submenu#moreMenu .submenu-quick-grid .tool-btn[data-feature-category="core"]::after { background: #ff9500; }
      .submenu#moreMenu .submenu-quick-grid .tool-btn[data-feature-category="tool"]::after { background: #007aff; }
      .theme-dark .submenu#moreMenu .submenu-quick-grid .tool-btn[data-feature-category]::after { border-color: #222; }
      .submenu#moreMenu .more-divider{width:1px;background:#e5e5e5;margin:0 24px}
      .submenu#moreMenu .submenu-body{padding:10px 12px 12px}
      /* 折叠支持：将带有 .foldable 的项在折叠时隐藏 */
      .floating-panel .foldable{display:flex;transition:opacity 180ms ease}
      .floating-panel.collapsed .foldable{display:none}
      /* 颜色区固定网格（两行） */
      .colorRow{display:grid;grid-template-columns:repeat(auto-fill,28px);grid-auto-rows:28px;gap:8px;justify-content:start;max-width:100%}
      .submenu.colors .color{width:28px;height:28px;border-radius:6px;border:1px solid #ddd;cursor:pointer}
      .submenu.colors .color.selected{outline:2px solid rgba(43,124,255,0.75);outline-offset:1px}
      .submenu .sizeControl{width:100%;display:flex;align-items:center;justify-content:center;padding-top:8px}
      .submenu .sizeControl input{width:120px}
      .submenu.actions button:not(.tool-btn){padding:12px 12px;border-radius:var(--ls-radius-sm);border:1px solid rgba(0,0,0,0.12);background:rgba(255,255,255,0.86);cursor:pointer;min-height:48px;touch-action:manipulation;-webkit-user-select:none;user-select:none;transition:transform var(--ls-press-dur) var(--ls-ease), box-shadow var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease);position:relative;overflow:hidden}
      .submenu.actions button:not(.tool-btn):active{transform:scale(0.95)}
      .mode-btn{padding:12px 12px;border-radius:var(--ls-radius-sm);border:1px solid rgba(0,0,0,0.12);background:rgba(255,255,255,0.86);cursor:pointer;min-height:48px;touch-action:manipulation;-webkit-user-select:none;user-select:none;text-align:left;color:var(--ls-sys-color-on-surface);transition:transform var(--ls-press-dur) var(--ls-ease), box-shadow var(--ls-theme-dur) var(--ls-ease), background-color var(--ls-theme-dur) var(--ls-ease), border-color var(--ls-theme-dur) var(--ls-ease);position:relative;overflow:hidden}
      .mode-btn:hover{box-shadow:0 6px 16px rgba(0,0,0,0.12)}
      .mode-btn:active{transform:scale(0.95)}
      .mode-btn.active{background:rgba(43,124,255,0.14);border-color:rgba(43,124,255,0.45)}
      .erase-mode-btn{display:flex;align-items:center;gap:6px;padding:6px 10px;font-size:12px;white-space:nowrap}
      .erase-mode-btn svg{width:20px;height:20px;flex-shrink:0;vertical-align:middle}
      .modeLabel{font-size:12px;color:#444;padding-top:6px;text-align:center}
      /* undo/redo use same .tool-btn sizing for visual consistency */
      .drag-handle{position:absolute;right:-14px;top:50%;transform:translateY(-50%);width:28px;height:48px;border-radius:8px;background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid #ccc;display:flex;align-items:center;justify-content:center;cursor:grab;box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}
      .drag-handle:active{cursor:grabbing}
      .floating-panel label{font-size:13px}

      .settings-modal{position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;z-index:4000}
      .settings-modal.open{display:flex}
      .settings-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.4)}
      .settings-panel{position:relative;background:#fff;border-radius:var(--ls-radius-md);padding:16px;box-shadow:0 12px 40px rgba(0,0,0,0.25);width:min(920px,92vw);max-height:min(720px,86vh);display:flex;flex-direction:column;overflow:hidden}
      .settings-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
      .settings-header h3{margin:0;font-size:20px;line-height:1.2}
      .settings-body{padding:12px;display:flex;flex-direction:column;gap:8px;min-height:0}
      .settings-body-gnome{padding:12px;min-height:0}
      .settings-shell{display:grid;grid-template-columns:200px 1fr;gap:16px;min-height:0;height:100%}
      .settings-sidebar{width:200px;display:flex;flex-direction:column;gap:6px;min-height:0}
      .settings-tab{width:200px;display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--ls-radius-md);border:1px solid rgba(0,0,0,0.06);background:rgba(0,0,0,0.02);cursor:pointer;color:#111;transition:background var(--ls-theme-dur) var(--ls-ease),border-color var(--ls-theme-dur) var(--ls-ease),transform var(--ls-press-dur) var(--ls-ease)}
      .settings-tab:hover{background:rgba(43,124,255,0.08);border-color:rgba(43,124,255,0.28)}
      .settings-tab[aria-selected="true"]{background:rgba(43,124,255,0.14);border-color:rgba(43,124,255,0.45)}
      .settings-tab:active{transform:translateY(1px)}
      .settings-tab .md-icon{flex:0 0 24px}
      .settings-tab-text{font-size:16px;font-weight:700}
      .settings-content{min-width:0;min-height:0;position:relative}
      .settings-content-inner{height:100%;min-height:0;overflow:auto;padding-right:4px}
      .settings-loading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:10px;background:rgba(255,255,255,0.72);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);z-index:2}
      .settings-loading[hidden]{display:none !important}
      .settings-spinner{width:18px;height:18px;border-radius:999px;border:2px solid rgba(0,0,0,0.18);border-top-color:var(--accent);animation:settingsSpin 900ms linear infinite}
      .settings-loading-text{font-size:12px;font-weight:700;color:#333}
      @keyframes settingsSpin{to{transform:rotate(360deg)}}
      .settings-page{opacity:0;transform:translateY(6px);pointer-events:none;transition:opacity 300ms ease,transform 300ms ease}
      .settings-page.active{opacity:1;transform:translateY(0);pointer-events:auto}
      .settings-cards{display:flex;flex-direction:column;gap:16px;padding:2px 2px 6px}
      .settings-card{border:1px solid rgba(0,0,0,0.08);border-radius:var(--ls-radius-md);background:rgba(255,255,255,0.98);box-shadow:0 10px 28px rgba(0,0,0,0.05);padding:14px}
      .settings-card-title{font-size:16px;font-weight:800;color:#111;margin-bottom:10px}
      .settings-card-body{display:flex;flex-direction:column;gap:10px}
      .settings-control{display:flex;align-items:center;gap:10px;font-size:16px;color:#222}
      .settings-field{display:grid;grid-template-columns:minmax(120px,1fr) minmax(160px,260px);align-items:center;gap:12px;font-size:16px;color:#222}
      .settings-field-label{color:#222;font-weight:600}
      .settings-field select,.settings-field input[type="text"]{width:100%;height:48px;border-radius:var(--ls-radius-sm);border:1px solid rgba(0,0,0,0.12);background:#fff;padding:0 12px;font-size:16px}
      .settings-field input[type="color"]{width:64px;height:48px;border-radius:var(--ls-radius-sm);border:1px solid rgba(0,0,0,0.12);background:#fff;padding:0}
      .settings-field input[type="range"]{width:100%}
      .settings-divider{height:1px;background:rgba(0,0,0,0.08)}
      .settings-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
      .settings-hint{font-size:14px;color:#555;max-width:75ch}
      
      .settings-menu-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;font-size:16px;color:#222;transition:opacity 0.2s ease}
      .settings-menu-item.disabled{opacity:0.6;cursor:not-allowed;pointer-events:none}
      .settings-menu-label{font-weight:600}
      .coming-soon-badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid rgba(43,124,255,0.3);background:rgba(43,124,255,0.08);color:#2b7cff;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}

      .theme-preview{border:1px solid rgba(0,0,0,0.10);border-radius:var(--ls-radius-md);padding:12px;background:rgba(255,255,255,0.72);backdrop-filter:blur(6px) saturate(var(--ls-mica-saturation));-webkit-backdrop-filter:blur(6px) saturate(var(--ls-mica-saturation));min-height:120px}
      .theme-preview-card{border-radius:var(--ls-radius-md);background:var(--ls-sys-color-surface);color:var(--ls-sys-color-on-surface);border:1px solid rgba(0,0,0,0.10);padding:14px;box-shadow:0 10px 22px rgba(0,0,0,0.06)}
      .theme-preview-title{font-size:20px;font-weight:800;line-height:1.2}
      .theme-preview-body{padding-top:6px;max-width:75ch}
      .theme-preview-actions{display:flex;gap:10px;flex-wrap:wrap;padding-top:10px;align-items:center}
      .theme-report{margin:10px 0 0;white-space:pre-wrap;font-size:12px;line-height:1.4;color:var(--ls-sys-color-on-surface);background:rgba(0,0,0,0.03);border:1px solid rgba(0,0,0,0.08);border-radius:var(--ls-radius-md);padding:10px;min-height:72px}
      .pen-tail-preview{width:100%;height:150px;display:block;border:1px solid rgba(0,0,0,0.10);border-radius:12px;background:rgba(255,255,255,0.85)}
      .settings-footer{display:flex;justify-content:flex-end;gap:8px;padding:8px 12px 12px}

      .resource-panel{width:min(980px,92vw);max-height:min(760px,86vh)}
      .resource-body{min-height:0}
      .resource-layout{display:grid;grid-template-columns:1fr 320px;gap:16px;min-height:0;height:100%}
      .resource-sort{min-width:0;min-height:0;display:flex;flex-direction:column;gap:8px}
      .resource-hint{font-size:12px;color:rgba(0,0,0,0.62)}
      .resource-list{display:flex;flex-direction:column;gap:8px;overflow:auto;min-height:0;padding-right:4px}
      .resource-item{display:grid;grid-template-columns:18px 1fr 44px;gap:10px;align-items:center;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,0.08);background:rgba(255,255,255,0.92)}
      .resource-item[aria-grabbed="true"]{border-color:rgba(43,124,255,0.45);box-shadow:0 10px 24px rgba(43,124,255,0.12)}
      .resource-drag{width:18px;line-height:18px;text-align:center;user-select:none;cursor:grab;opacity:0.8}
      .resource-drag:active{cursor:grabbing}
      .resource-label{min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .resource-preview{border:1px solid rgba(0,0,0,0.08);border-radius:12px;background:rgba(0,0,0,0.02);padding:10px;display:flex;flex-direction:column;gap:10px;min-height:0}
      .resource-preview-title{font-size:12px;font-weight:800;color:rgba(0,0,0,0.62)}
      .resource-preview-grid{display:grid;grid-template-columns:repeat(3,48px);grid-auto-rows:48px;gap:8px;align-content:start;justify-content:start;min-height:0;overflow:auto;padding-right:4px}
      .resource-footer{display:flex;justify-content:flex-end;gap:8px;padding:8px 12px 12px;border-top:1px solid rgba(0,0,0,0.08)}
      
      .plugin-panel{width:640px;max-width:92vw}
      .plugin-body{gap:10px}
      .plugin-install-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
      .plugin-status{font-size:12px;color:#444;margin-left:auto;min-height:18px}
      .plugin-drop{border:1px dashed rgba(0,0,0,0.25);border-radius:12px;padding:12px;background:rgba(255,255,255,0.75);transition:border-color 160ms ease,background 160ms ease}
      .plugin-drop.dragover{border-color:#2b7cff;background:rgba(43,124,255,0.08)}
      .plugin-drop-title{font-weight:600}
      .plugin-drop-sub{font-size:12px;color:#555;padding-top:4px}
      .plugin-progress{width:100%;margin-top:10px;height:12px}
      .plugin-list-head{display:flex;justify-content:space-between;align-items:center;padding-top:6px}
      .plugin-list-hint{font-size:12px;color:#666}
      .plugin-list{display:flex;flex-direction:column;gap:10px}
      .plugin-item{display:grid;grid-template-columns:18px 1fr auto;gap:10px;align-items:start;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,0.08);background:rgba(255,255,255,0.92)}
      .plugin-item[aria-disabled="true"]{opacity:0.6}
      .plugin-drag{width:18px;line-height:18px;text-align:center;user-select:none;cursor:grab;opacity:0.8}
      .plugin-drag:active{cursor:grabbing}
      .plugin-title{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
      .plugin-name{font-weight:700}
      .plugin-ver{font-size:12px;color:#666}
      .plugin-author{font-size:12px;color:#666}
      .plugin-meta{font-size:12px;color:#555;padding-top:6px;display:flex;flex-direction:column;gap:6px}
      .plugin-badges{display:flex;gap:6px;flex-wrap:wrap}
      .plugin-badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid rgba(0,0,0,0.12);background:rgba(0,0,0,0.03)}
      .plugin-sig-ok{border-color:rgba(46,204,113,0.45);background:rgba(46,204,113,0.10)}
      .plugin-sig-warn{border-color:rgba(245,158,11,0.55);background:rgba(245,158,11,0.12)}
      .plugin-sig-bad{border-color:rgba(239,68,68,0.55);background:rgba(239,68,68,0.10)}
      .plugin-warning{color:#a16207}
      .plugin-actions{display:flex;gap:8px;align-items:center}
      input.plugin-toggle{appearance:none;-webkit-appearance:none;width:42px;height:24px;border-radius:999px;border:1px solid rgba(0,0,0,0.18);background:rgba(0,0,0,0.10);position:relative;cursor:pointer;outline:none;transition:background 140ms ease,border-color 140ms ease}
      input.plugin-toggle::before{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:999px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.18);transition:left 140ms ease}
      input.plugin-toggle:checked{background:rgba(46,204,113,0.35);border-color:rgba(46,204,113,0.55)}
      input.plugin-toggle:checked::before{left:20px}
      input.plugin-toggle:focus-visible{outline:2px solid rgba(43,124,255,0.75);outline-offset:2px}
      .color:focus-visible,.mode-btn:focus-visible,.tool-btn:focus-visible,.plugin-drop:focus-visible{outline:2px solid rgba(43,124,255,0.75);outline-offset:2px}

      /* Dark theme styles */
      /* Dark theme palette and layered blacks */
      .theme-dark {
        --bg-1: var(--ls-sys-color-background);
        --bg-2: rgba(20,20,22,0.7);
        --panel: rgba(24,24,26,0.6);
        --surface: var(--ls-sys-color-surface);
        --muted: #9aa0a6;
        --text: var(--ls-sys-color-on-surface);
        --subtle: #bdbdbd;
        --accent: var(--ls-sys-color-primary);

        --text-high: rgba(255,255,255,0.87);
        --text-medium: rgba(255,255,255,0.60);
        --text-disabled: rgba(255,255,255,0.38);

        --primary-container: #2b5b9a;
        --on-primary-container: #eaf1ff;
        --secondary-container: #334155;
        --on-secondary-container: #e9eef6;
        --surface-container-lowest: var(--ls-dark-surface);
        --ls-elev0-overlay: rgba(255,255,255,0.05);

        --ls-fluent-btn-bg: var(--ls-dark-surface);
        --ls-fluent-btn-fg: var(--ls-dark-on-surface);
        --ls-fluent-btn-border: rgba(255,255,255,0.10);
        --ls-fluent-btn-hover-shadow: 0 0 0 0 rgba(0,0,0,0);
        --ls-fluent-btn-active-bg: var(--ls-dark-surface);
        --ls-fluent-btn-active-border: rgba(255,255,255,0.18);
      }
      .theme-dark body, .theme-dark html { background: transparent; color: var(--text-high); }
      .theme-dark body[data-app-mode="whiteboard"] .canvas-wrap { background: var(--bg-1); }
      .theme-dark .floating-panel{background: var(--ls-dark-surface); box-shadow:none; border:1px solid rgba(255,255,255,0.06);}
      .theme-dark .tool-btn{background: var(--ls-dark-surface); color: var(--ls-dark-on-surface);}
      .theme-dark .submenu{background: rgba(12,12,12,0.9); border: 1px solid rgba(255,255,255,0.04); color: var(--text)}
      .theme-dark .submenu .submenu-quick{background:rgba(255,255,255,0.03);border-right-color:rgba(255,255,255,0.06)}
      .theme-dark .settings-panel{background:#0f1011;color:var(--text);box-shadow:0 14px 48px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .settings-tab{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.06);color:var(--text)}
      .theme-dark .settings-tab:hover{background:rgba(90,160,255,0.10);border-color:rgba(90,160,255,0.26)}
      .theme-dark .settings-tab[aria-selected="true"]{background:rgba(90,160,255,0.14);border-color:rgba(90,160,255,0.34)}
      .theme-dark .settings-card{background:rgba(12,12,12,0.42);border-color:rgba(255,255,255,0.06);box-shadow:none}
      .theme-dark .settings-card-title{color:var(--text)}
      .theme-dark .settings-control,.theme-dark .settings-field-label{color:rgba(230,230,230,0.9)}
      .theme-dark .settings-field select,.theme-dark .settings-field input[type="text"],.theme-dark .settings-field input[type="color"]{background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.08);color:var(--text)}
      .theme-dark .settings-divider{background:rgba(255,255,255,0.08)}
      .theme-dark .settings-hint{color:rgba(230,230,230,0.7)}
      .theme-dark .settings-loading{background:rgba(12,12,12,0.55)}
      .theme-dark .settings-spinner{border-color:rgba(255,255,255,0.14);border-top-color:var(--accent)}
      .theme-dark .settings-loading-text{color:rgba(230,230,230,0.9)}
      .theme-dark .settings-menu-item{color:var(--text)}
      .theme-dark .coming-soon-badge{border-color:rgba(90,160,255,0.34);background:rgba(90,160,255,0.14);color:#5aa0ff}

      @media (max-width: 560px){
        .settings-panel{width:min(520px,92vw);max-height:92vh}
        .settings-shell{grid-template-columns:1fr;gap:12px}
        .settings-sidebar{width:auto;flex-direction:row;overflow:auto;gap:8px;padding-bottom:4px}
        .settings-tab{width:auto;min-width:160px;justify-content:flex-start}
        .settings-field{grid-template-columns:1fr}
      }
      .theme-dark .submenu .mode-btn, .theme-dark .submenu .submenu-pin, .theme-dark .submenu .submenu-drag-handle, .theme-dark .submenu.actions button:not(.tool-btn){
        background:var(--ls-dark-surface);
        color:var(--ls-dark-on-surface);
        border-color:rgba(255,255,255,0.10);
      }
      .theme-dark .submenu .mode-btn:hover, .theme-dark .submenu .mode-btn[data-force-hover="true"], .theme-dark .submenu .submenu-pin:hover, .theme-dark .submenu .submenu-pin[data-force-hover="true"], .theme-dark .submenu .submenu-drag-handle:hover, .theme-dark .submenu .submenu-drag-handle[data-force-hover="true"], .theme-dark .submenu.actions button:not(.tool-btn):hover, .theme-dark .submenu.actions button:not(.tool-btn)[data-force-hover="true"]{
        box-shadow: inset 0 0 0 999px var(--ls-dark-hover-overlay);
      }
      .theme-dark .submenu .mode-btn:active, .theme-dark .submenu .mode-btn[data-force-active="true"], .theme-dark .submenu .submenu-pin:active, .theme-dark .submenu .submenu-pin[data-force-active="true"], .theme-dark .submenu .submenu-drag-handle:active, .theme-dark .submenu .submenu-drag-handle[data-force-active="true"], .theme-dark .submenu.actions button:not(.tool-btn):active, .theme-dark .submenu.actions button:not(.tool-btn)[data-force-active="true"]{
        box-shadow: inset 0 0 0 999px var(--ls-dark-press-overlay);
      }
      .theme-dark .mode-btn.active{background:var(--ls-dark-surface);border-color:rgba(255,255,255,0.18);color:var(--ls-dark-on-surface)}
      .theme-dark .theme-preview{background:rgba(12,12,12,0.36);border-color:rgba(255,255,255,0.08)}
      .theme-dark .theme-report{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.08);color:rgba(230,230,230,0.88)}

      .theme-high-contrast{
        --text-high: rgba(0,0,0,0.95);
        --text-medium: rgba(0,0,0,0.80);
        --text-disabled: rgba(0,0,0,0.60);
      }

      .mica-surface{position:relative;overflow:hidden}
      .mica-surface::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg, rgba(255,255,255,var(--ls-mica-overlay)), rgba(255,255,255,0));mix-blend-mode:soft-light;pointer-events:none}
      .mica-surface{backdrop-filter:blur(var(--ls-mica-blur)) saturate(var(--ls-mica-saturation));-webkit-backdrop-filter:blur(var(--ls-mica-blur)) saturate(var(--ls-mica-saturation))}
      .mica-surface{mask-image:radial-gradient(closest-side, rgba(0,0,0,1) calc(100% - var(--ls-mica-feather)), rgba(0,0,0,0) 100%)}
      .visual-blur .floating-panel,.visual-blur .submenu,.visual-blur #pageToolbar,.visual-blur .settings-panel,.visual-blur .recognition-ui,.visual-blur .settings-card,.visual-blur .plugin-item{backdrop-filter:blur(var(--ls-mica-blur)) saturate(var(--ls-mica-saturation));-webkit-backdrop-filter:blur(var(--ls-mica-blur)) saturate(var(--ls-mica-saturation))}
      .visual-blur .floating-panel,.visual-blur .submenu,.visual-blur #pageToolbar,.visual-blur .settings-panel,.visual-blur .recognition-ui,.visual-blur .settings-card,.visual-blur .plugin-item{mask-image:radial-gradient(closest-side, rgba(0,0,0,1) calc(100% - var(--ls-mica-feather)), rgba(0,0,0,0) 100%)}
      .visual-blur .floating-panel::before,.visual-blur .submenu::before,.visual-blur #pageToolbar::before,.visual-blur .settings-panel::before,.visual-blur .recognition-ui::before,.visual-blur .settings-card::before,.visual-blur .plugin-item::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg, rgba(255,255,255,var(--ls-mica-overlay)), rgba(255,255,255,0));mix-blend-mode:soft-light;pointer-events:none}

      .ripple{position:absolute;border-radius:999px;transform:translate(-50%,-50%) scale(0);background:rgba(255,255,255,0.35);pointer-events:none;animation:rippleAnim 300ms ease-out}
      @keyframes rippleAnim{to{transform:translate(-50%,-50%) scale(1);opacity:0}}

      @media (prefers-reduced-motion: reduce){
        html,body,.tool-btn,.mode-btn,.md3-button,.settings-tab,.settings-page{transition-duration:1ms !important}
      }
      .theme-dark .plugin-status{color:rgba(230,230,230,0.75)}
      .theme-dark .plugin-drop{border-color:rgba(255,255,255,0.12);background:rgba(12,12,12,0.40)}
      .theme-dark .plugin-drop-sub{color:rgba(230,230,230,0.7)}
      .theme-dark .plugin-item{border-color:rgba(255,255,255,0.06);background:rgba(12,12,12,0.42)}
      .theme-dark .plugin-ver,.theme-dark .plugin-author{color:rgba(230,230,230,0.65)}
      .theme-dark .plugin-meta{color:rgba(230,230,230,0.75)}
      .theme-dark .plugin-badge{border-color:rgba(255,255,255,0.10);background:rgba(255,255,255,0.03)}
      .theme-dark input.plugin-toggle{border-color:rgba(255,255,255,0.14);background:rgba(255,255,255,0.08)}
      .theme-dark input.plugin-toggle::before{background:rgba(255,255,255,0.92)}
      .theme-dark .erase-mode-btn svg{color:var(--text)}
      .erase-mode-btn svg *{stroke:currentColor;fill:currentColor}

      /* SVG icons: adopt currentColor for stroke/fill in dark theme */
      .theme-dark .tool-btn svg, .theme-dark .mode-btn svg, .theme-dark .page-new-btn svg { color: var(--text); }
      .theme-dark .tool-btn svg *{ stroke: currentColor !important; fill: currentColor !important; }

      /* submenu body text and labels */
      .theme-dark .submenu .submenu-body, .theme-dark .submenu .submenu-body label, .theme-dark .modeLabel{color:var(--subtle)}
      .theme-dark .submenu .submenu-footer{background:transparent;border-top-color:rgba(255,255,255,0.02)}
      @media (max-width: 420px){
        .submenu .submenu-quick{width:64px;flex-basis:64px;padding:10px 8px 10px 10px}
      }

      /* Color swatches border contrast */
      .theme-dark .colorRow .color{border-color:rgba(255,255,255,0.06)}

      /* Hover/active for page toolbar and controls */
      .theme-dark #pageToolbar{background: rgba(12,12,12,0.6);box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-btn{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.04);color:var(--text)}
      .theme-dark .page-btn:hover{background:rgba(255,255,255,0.03)}
      .theme-dark .page-btn[disabled]{opacity:0.35}

      /* page new control */
      .theme-dark .page-new{background:rgba(255,255,255,0.02);box-shadow:none;border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-new-btn{background:linear-gradient(90deg, rgba(90,160,255,0.14), rgba(60,120,210,0.12));border-color:rgba(90,160,255,0.28);color:var(--text)}

      /* drag handle in dark */
      .theme-dark .drag-handle{background:linear-gradient(180deg,#222,#171717);border:1px solid rgba(255,255,255,0.04);color:var(--text)}

      /* Page toolbar (bottom-left) */
      #pageToolbar{position:fixed;left:20px;bottom:20px;z-index:1300;background:rgba(255,255,255,0.98);border-radius:12px;padding:8px 10px;box-shadow:0 8px 20px rgba(0,0,0,0.12);display:flex;align-items:center;gap:8px;font-family:Arial,Helvetica,sans-serif}
      .page-btn{width:40px;height:36px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
      .page-btn[disabled]{opacity:0.5;cursor:default}

      .page-label{min-width:72px;text-align:center;font-size:13px;color:#333}
      .page-new{display:flex;align-items:center;padding:6px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fff;box-shadow:0 6px 16px rgba(0,0,0,0.06)}
      .page-new-btn{padding:6px 10px;border-radius:8px;border:1px solid #2b7cff;background:#eaf2ff;cursor:pointer}

      .theme-dark .page-label{color:#ddd}
      .theme-dark .page-new{background:rgba(255,255,255,0.02);box-shadow:none;border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-new-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);color:#e6e6e6}

      /* dark theme for page toolbar and controls */
      .theme-dark #pageToolbar{background: rgba(24,24,24,0.7);box-shadow:0 8px 24px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.04)}

      body.standalone-window .canvas-wrap{display:none}
      body.standalone-window #pageToolbar{display:none}
      body.standalone-window .floating-panel{display:none}
      body.standalone-window .settings-modal{position:static;inset:auto;display:flex;align-items:stretch;justify-content:stretch;height:100vh;width:100vw}
      body.standalone-window .settings-backdrop{display:none}
      body.standalone-window .settings-panel{width:100%;max-height:none;height:100%;border-radius:0;box-shadow:none}
      body.standalone-window .settings-body{flex:1;overflow:hidden}
      body.standalone-window .settings-content-inner{height:100%}
      .theme-dark .page-btn{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.04);color:#e6e6e6}
      .theme-dark .drag-handle{background:linear-gradient(180deg,#2a2a2a,#222);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .colorRow .color{border-color:rgba(255,255,255,0.06)}

      /* Toast notifications */
      .app-toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;z-index:6000;min-width:220px;max-width:80%;padding:10px 14px;border-radius:10px;background:rgba(0,0,0,0.8);color:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.4);opacity:0;transition:opacity 220ms ease,bottom 220ms ease}
      .app-toast.show{opacity:1;bottom:40px}
      .app-toast.success{background:linear-gradient(90deg,#2ecc71,#27ae60)}
      .app-toast.error{background:linear-gradient(90deg,#ff6b6b,#e74c3c)}

      .recognition-ui{position:fixed;z-index:6500;display:none;gap:8px;transform:translate(-50%,-120%);padding:8px 10px;border-radius:12px;background:rgba(255,255,255,0.92);border:1px solid rgba(0,0,0,0.08);box-shadow:0 10px 26px rgba(0,0,0,0.18);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
      .recognition-ui.open{display:flex}
      .recognition-ui button{padding:6px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.12);background:#fff;cursor:pointer}
      .recognition-ui button[data-action="confirm"]{border-color:rgba(43,124,255,0.35);background:rgba(43,124,255,0.10)}
      .theme-dark .recognition-ui{background:rgba(12,12,12,0.72);border:1px solid rgba(255,255,255,0.06)}
      .theme-dark .recognition-ui button{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.06);color:var(--text)}
      .theme-dark .recognition-ui button[data-action="confirm"]{background:rgba(90,160,255,0.14);border-color:rgba(90,160,255,0.28)}

      /* Visual style variants: applied as class on documentElement: visual-solid | visual-blur | visual-transparent */
      .visual-solid .floating-panel{background:rgba(255,255,255,1);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 12px 36px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid .submenu{background:rgba(255,255,255,1);backdrop-filter:none;box-shadow:0 10px 28px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid #pageToolbar{background:rgba(255,255,255,1);box-shadow:0 10px 28px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid .drag-handle{background:linear-gradient(180deg,#fafafa,#eee);box-shadow:0 4px 12px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.08)}

      .visual-blur .floating-panel{background:rgba(255,255,255,0.7);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);box-shadow:0 8px 30px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.04)}
      .visual-blur .submenu{background:rgba(255,255,255,0.9);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);box-shadow:0 8px 22px rgba(0,0,0,0.12)}
      .visual-blur #pageToolbar{background:rgba(255,255,255,0.9);backdrop-filter:blur(6px)}
      .visual-blur .drag-handle{background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid rgba(0,0,0,0.06);box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}

      /* transparent: like blur but without backdrop-filter (i.e. remove blur effect) */
      .visual-transparent .floating-panel{background:rgba(255,255,255,0.7);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 8px 30px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.04)}
      .visual-transparent .submenu{background:rgba(255,255,255,0.9);backdrop-filter:none;box-shadow:0 8px 22px rgba(0,0,0,0.12)}
      .visual-transparent #pageToolbar{background:rgba(255,255,255,0.9);box-shadow:0 8px 22px rgba(0,0,0,0.12)}

      /* Page Preview Sidebar */
      #pagePreviewSidebar {
        position: fixed;
        left: -25%;
        top: 0;
        bottom: 0;
        width: 18%;
        min-width: 160px;
        max-width: 300px;
        background: var(--ls-fluent-btn-bg, rgba(255, 255, 255, 0.95));
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        z-index: 1250;
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        border-right: 1px solid rgba(0,0,0,0.05);
      }
      #pagePreviewSidebar.open {
        left: 0;
      }
      .theme-dark #pagePreviewSidebar {
        background: rgba(28, 28, 28, 0.9);
        border-right-color: rgba(255,255,255,0.05);
      }
      .page-preview-header {
        padding: 16px;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        color: var(--ls-fluent-btn-fg, #333);
      }
      .page-preview-list {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        scrollbar-width: thin;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }
      .page-preview-item {
        position: relative;
        cursor: pointer;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid transparent;
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.2s, box-shadow 0.2s;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        flex-shrink: 0;
        animation: previewFadeIn 0.3s ease-out;
      }
      @keyframes previewFadeIn {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
      }
      .page-preview-item:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      }
      .page-preview-item.active {
        border-color: #2b7cff;
        box-shadow: 0 0 0 2px rgba(43, 124, 255, 0.2);
        transform: scale(1.02);
      }
      .page-preview-item img {
        width: 100%;
        height: auto;
        display: block;
        min-height: 80px;
        background: #f0f0f0;
        transition: opacity 0.3s ease;
      }
      .page-preview-item img[src=""] {
        opacity: 0;
      }
      .page-preview-num {
        position: absolute;
        bottom: 4px;
        right: 8px;
        font-size: 11px;
        background: rgba(0,0,0,0.5);
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        backdrop-filter: blur(4px);
      }
      .page-label {
        cursor: pointer;
        padding: 0 8px;
        border-radius: 6px;
        transition: background-color 0.2s;
      }
      .page-label:hover {
        background: rgba(0,0,0,0.05);
      }
      .theme-dark .page-label:hover {
        background: rgba(255,255,255,0.05);
      }
      .visual-transparent .drag-handle{background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid rgba(0,0,0,0.06);box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}
      /* Dark-mode adjustments for visual variants */
      .theme-dark.visual-solid .floating-panel{background:rgba(24,24,24,1);border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 36px rgba(0,0,0,0.6)}
      .theme-dark.visual-solid .submenu{background:rgba(18,18,18,1);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark.visual-solid #pageToolbar{background:rgba(18,18,18,1)}
      .theme-dark.visual-solid .drag-handle{background:linear-gradient(180deg,#2a2a2a,#1b1b1b);border:1px solid rgba(255,255,255,0.04)}

      .theme-dark.visual-blur .floating-panel{background:rgba(24,24,24,0.6);backdrop-filter:blur(8px)}
      .theme-dark.visual-blur .submenu{background:rgba(12,12,12,0.9);backdrop-filter:blur(4px)}
      .theme-dark.visual-blur #pageToolbar{background:rgba(24,24,24,0.6)}
      .theme-dark.visual-blur .drag-handle{background:linear-gradient(180deg,#2a2a2a,#171717);border:1px solid rgba(255,255,255,0.04);box-shadow:0 4px 12px rgba(0,0,0,0.6);color:var(--text)}

      .theme-dark.visual-transparent .floating-panel{background:rgba(12,12,12,0.12);border:1px solid rgba(255,255,255,0.03)}
      .theme-dark.visual-transparent .submenu{background:rgba(12,12,12,0.06)}
      .theme-dark.visual-transparent #pageToolbar{background:rgba(12,12,12,0.06)}
      .theme-dark.visual-transparent .drag-handle{background:linear-gradient(180deg,#2a2a2a,#171717);border:1px solid rgba(255,255,255,0.04);box-shadow:0 4px 12px rgba(0,0,0,0.6);color:var(--text)}
    </style>
  </body>
</html>
