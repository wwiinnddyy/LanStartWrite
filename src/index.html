<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data:;" />
    <title>Electron Starter</title>
  </head>
  <body>
    <div class="canvas-wrap">
      <canvas id="board"></canvas>
    </div>

    <script type="module" src="ui-bootstrap.js"></script>
    <style>
      html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:transparent}
      .canvas-wrap{height:100%;background:transparent;display:flex}
      body[data-app-mode="whiteboard"] .canvas-wrap{background:#ffffff}
      #board{flex:1;display:block;width:100%;height:100%;touch-action:none;background:transparent}
      .floating-panel{position:fixed;right:20px;top:80px;width:auto;min-width:64px;max-width:calc(100vw - 40px);border-radius:18px;padding:12px;background:rgba(255,255,255,0.96);box-shadow:0 8px 24px rgba(0,0,0,0.15);z-index:3000;display:flex;flex-direction:column;gap:10px;align-items:flex-start;transition:width 240ms cubic-bezier(0.22,0.9,0.33,1),border-radius 200ms ease}
      /* blur + translucent style for floating panel */
      .floating-panel{position:fixed;right:20px;top:80px;width:auto;min-width:64px;max-width:calc(100vw - 40px);border-radius:18px;padding:12px;background:rgba(255,255,255,0.7);backdrop-filter: blur(8px);-webkit-backdrop-filter: blur(8px);box-shadow:0 8px 24px rgba(0,0,0,0.15);z-index:3000;display:flex;flex-direction:column;gap:10px;align-items:flex-start;transition:width 240ms cubic-bezier(0.22,0.9,0.33,1),border-radius 200ms ease}
      .floating-panel .panel-section{width:auto;display:flex;gap:8px;align-items:center;justify-content:flex-start;flex-wrap:nowrap}
      .floating-panel .tools{justify-content:flex-start}
      .tool{position:relative}
      .tool-btn{width:44px;height:44px;border-radius:10px;border:1px solid #ccc;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
      .tool-btn.active{box-shadow:inset 0 -2px 0 rgba(0,0,0,0.06);background:#f6f6f6}
      /* 子菜单为固定排版：固定宽度，自适应高度包含所有控件 */
      .submenu{position:absolute;right:0;top:48px;background:rgba(255,255,255,0.97);padding:0;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,0.12);display:none;z-index:2500;width:240px;box-sizing:border-box;transition:top 0.3s cubic-bezier(0.25,0.46,0.45,0.94),opacity 0.3s ease;flex-direction:column;overflow:hidden}
      .submenu.open{display:flex}
      .submenu .submenu-body{padding:12px;display:flex;flex-direction:column;gap:8px}
      .submenu .submenu-pin{border:1px solid #ccc;background:#fff;padding:6px 8px;border-radius:8px;cursor:pointer}
      .submenu .submenu-footer{display:flex;justify-content:flex-end;gap:8px;padding:8px 12px;border-top:1px solid #e5e5e5;background:rgba(255,255,255,0.5)}
      .submenu .submenu-drag-handle{border:1px solid #ccc;background:#fff;padding:6px 8px;border-radius:8px;cursor:grab}
      .submenu.colors{width:240px;box-sizing:border-box}
      /* 折叠支持：将带有 .foldable 的项在折叠时隐藏 */
      .floating-panel .foldable{display:flex;transition:opacity 180ms ease}
      .floating-panel.collapsed .foldable{display:none}
      /* 颜色区固定网格（两行） */
      .colorRow{display:grid;grid-template-columns:repeat(7,28px);grid-auto-rows:28px;gap:8px;justify-content:start}
      .submenu.colors .color{width:28px;height:28px;border-radius:6px;border:1px solid #ddd;cursor:pointer}
      .submenu .sizeControl{width:100%;display:flex;align-items:center;justify-content:center;padding-top:8px}
      .submenu .sizeControl input{width:120px}
      .submenu.actions button{padding:6px 10px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer}
      .mode-btn{padding:6px 8px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
      .mode-btn.active{background:#e6f0ff;border-color:#6ca0ff}
      .erase-mode-btn{display:flex;align-items:center;gap:6px;padding:6px 10px;font-size:12px;white-space:nowrap}
      .erase-mode-btn svg{width:20px;height:20px;flex-shrink:0;vertical-align:middle}
      .modeLabel{font-size:12px;color:#444;padding-top:6px;text-align:center}
      /* undo/redo use same .tool-btn sizing for visual consistency */
      .drag-handle{position:absolute;right:-14px;top:50%;transform:translateY(-50%);width:28px;height:48px;border-radius:8px;background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid #ccc;display:flex;align-items:center;justify-content:center;cursor:grab;box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}
      .drag-handle:active{cursor:grabbing}
      .floating-panel label{font-size:13px}

      /* settings modal */
      .settings-modal{position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;z-index:4000}
      .settings-modal.open{display:flex}
      .settings-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.4)}
      .settings-panel{position:relative;background:#fff;border-radius:12px;padding:16px;box-shadow:0 12px 40px rgba(0,0,0,0.25);width:320px;max-width:92%}
      .settings-header{display:flex;justify-content:space-between;align-items:center}
      .settings-body{padding:12px;display:flex;flex-direction:column;gap:8px}
      .settings-footer{display:flex;justify-content:flex-end;gap:8px;padding-top:8px}

      /* Dark theme styles */
      /* Dark theme palette and layered blacks */
      .theme-dark body, .theme-dark html { background: #0b0b0c; color: #e6e6e6; }
      .theme-dark { --bg-1: #0b0b0c; --bg-2: rgba(20,20,22,0.7); --panel: rgba(24,24,26,0.6); --surface: #121214; --muted: #9aa0a6; --text: #e6e6e6; --subtle: #bdbdbd; --accent: #5aa0ff; }
      .theme-dark .floating-panel{background: var(--panel); box-shadow: 0 10px 36px rgba(0,0,0,0.7); border: 1px solid rgba(255,255,255,0.04);}
      .theme-dark .tool-btn{background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.05); color: var(--text);}
      .theme-dark .tool-btn:hover{background: rgba(255,255,255,0.04)}
      .theme-dark .tool-btn.active{background: rgba(90,160,255,0.12); border-color: rgba(90,160,255,0.28); box-shadow: 0 6px 18px rgba(90,160,255,0.08); color: var(--text)}
      .theme-dark .submenu{background: rgba(12,12,12,0.9); border: 1px solid rgba(255,255,255,0.04); color: var(--text)}
      .theme-dark .settings-panel{background:#0f1011;color:var(--text);box-shadow:0 14px 48px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .mode-btn, .theme-dark .submenu .submenu-pin, .theme-dark .submenu .submenu-drag-handle{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.05);color:var(--text)}
      .theme-dark .mode-btn:hover{background:rgba(255,255,255,0.04)}
      .theme-dark .mode-btn.active{background:rgba(90,160,255,0.12);border-color:rgba(90,160,255,0.28);color:var(--text)}
      .theme-dark .erase-mode-btn svg{color:var(--text)}
      .erase-mode-btn svg *{stroke:currentColor;fill:currentColor}

      /* SVG icons: adopt currentColor for stroke/fill in dark theme */
      .theme-dark .tool-btn svg, .theme-dark .mode-btn svg, .theme-dark .page-new-btn svg { color: var(--text); }
      .theme-dark .tool-btn svg *{ stroke: currentColor !important; fill: currentColor !important; }

      /* submenu body text and labels */
      .theme-dark .submenu .submenu-body, .theme-dark .submenu .submenu-body label, .theme-dark .modeLabel{color:var(--subtle)}
      .theme-dark .submenu .submenu-footer{background:transparent;border-top-color:rgba(255,255,255,0.02)}

      /* Color swatches border contrast */
      .theme-dark .colorRow .color{border-color:rgba(255,255,255,0.06)}

      /* Hover/active for page toolbar and controls */
      .theme-dark #pageToolbar{background: rgba(12,12,12,0.6);box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-btn{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.04);color:var(--text)}
      .theme-dark .page-btn:hover{background:rgba(255,255,255,0.03)}
      .theme-dark .page-btn[disabled]{opacity:0.35}

      /* page new control */
      .theme-dark .page-new{background:rgba(255,255,255,0.02);box-shadow:none;border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-new-btn{background:linear-gradient(90deg, rgba(90,160,255,0.14), rgba(60,120,210,0.12));border-color:rgba(90,160,255,0.28);color:var(--text)}

      /* drag handle in dark */
      .theme-dark .drag-handle{background:linear-gradient(180deg,#222,#171717);border:1px solid rgba(255,255,255,0.04);color:var(--text)}

      /* Page toolbar (bottom-left) */
      #pageToolbar{position:fixed;left:20px;bottom:20px;z-index:1300;background:rgba(255,255,255,0.98);border-radius:12px;padding:8px 10px;box-shadow:0 8px 20px rgba(0,0,0,0.12);display:flex;align-items:center;gap:8px;font-family:Arial,Helvetica,sans-serif}
      .page-btn{width:40px;height:36px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
      .page-btn[disabled]{opacity:0.5;cursor:default}

      .page-label{min-width:72px;text-align:center;font-size:13px;color:#333}
      .page-new{display:flex;align-items:center;padding:6px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fff;box-shadow:0 6px 16px rgba(0,0,0,0.06)}
      .page-new-btn{padding:6px 10px;border-radius:8px;border:1px solid #2b7cff;background:#eaf2ff;cursor:pointer}

      .theme-dark .page-label{color:#ddd}
      .theme-dark .page-new{background:rgba(255,255,255,0.02);box-shadow:none;border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-new-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);color:#e6e6e6}

      /* dark theme for page toolbar and controls */
      .theme-dark #pageToolbar{background: rgba(24,24,24,0.7);box-shadow:0 8px 24px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .page-btn{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.04);color:#e6e6e6}
      .theme-dark .drag-handle{background:linear-gradient(180deg,#2a2a2a,#222);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark .colorRow .color{border-color:rgba(255,255,255,0.06)}

      /* Toast notifications */
      .app-toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;z-index:6000;min-width:220px;max-width:80%;padding:10px 14px;border-radius:10px;background:rgba(0,0,0,0.8);color:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.4);opacity:0;transition:opacity 220ms ease,bottom 220ms ease}
      .app-toast.show{opacity:1;bottom:40px}
      .app-toast.success{background:linear-gradient(90deg,#2ecc71,#27ae60)}
      .app-toast.error{background:linear-gradient(90deg,#ff6b6b,#e74c3c)}

      /* Visual style variants: applied as class on documentElement: visual-solid | visual-blur | visual-transparent */
      .visual-solid .floating-panel{background:rgba(255,255,255,1);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 12px 36px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid .submenu{background:rgba(255,255,255,1);backdrop-filter:none;box-shadow:0 10px 28px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid #pageToolbar{background:rgba(255,255,255,1);box-shadow:0 10px 28px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.06)}
      .visual-solid .drag-handle{background:linear-gradient(180deg,#fafafa,#eee);box-shadow:0 4px 12px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.08)}

      .visual-blur .floating-panel{background:rgba(255,255,255,0.7);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);box-shadow:0 8px 30px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.04)}
      .visual-blur .submenu{background:rgba(255,255,255,0.9);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);box-shadow:0 8px 22px rgba(0,0,0,0.12)}
      .visual-blur #pageToolbar{background:rgba(255,255,255,0.9);backdrop-filter:blur(6px)}
      .visual-blur .drag-handle{background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid rgba(0,0,0,0.06);box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}

      /* transparent: like blur but without backdrop-filter (i.e. remove blur effect) */
      .visual-transparent .floating-panel{background:rgba(255,255,255,0.7);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 8px 30px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.04)}
      .visual-transparent .submenu{background:rgba(255,255,255,0.9);backdrop-filter:none;box-shadow:0 8px 22px rgba(0,0,0,0.12)}
      .visual-transparent #pageToolbar{background:rgba(255,255,255,0.9);box-shadow:0 8px 22px rgba(0,0,0,0.12)}
      .visual-transparent .drag-handle{background:linear-gradient(180deg,#f5f5f5,#eee);border:1px solid rgba(0,0,0,0.06);box-shadow:0 4px 12px rgba(0,0,0,0.08);color:#333}
      /* Dark-mode adjustments for visual variants */
      .theme-dark.visual-solid .floating-panel{background:rgba(24,24,24,1);border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 36px rgba(0,0,0,0.6)}
      .theme-dark.visual-solid .submenu{background:rgba(18,18,18,1);border:1px solid rgba(255,255,255,0.04)}
      .theme-dark.visual-solid #pageToolbar{background:rgba(18,18,18,1)}
      .theme-dark.visual-solid .drag-handle{background:linear-gradient(180deg,#2a2a2a,#1b1b1b);border:1px solid rgba(255,255,255,0.04)}

      .theme-dark.visual-blur .floating-panel{background:rgba(24,24,24,0.6);backdrop-filter:blur(8px)}
      .theme-dark.visual-blur .submenu{background:rgba(12,12,12,0.9);backdrop-filter:blur(4px)}
      .theme-dark.visual-blur #pageToolbar{background:rgba(24,24,24,0.6)}
      .theme-dark.visual-blur .drag-handle{background:linear-gradient(180deg,#2a2a2a,#171717);border:1px solid rgba(255,255,255,0.04);box-shadow:0 4px 12px rgba(0,0,0,0.6);color:var(--text)}

      .theme-dark.visual-transparent .floating-panel{background:rgba(12,12,12,0.12);border:1px solid rgba(255,255,255,0.03)}
      .theme-dark.visual-transparent .submenu{background:rgba(12,12,12,0.06)}
      .theme-dark.visual-transparent #pageToolbar{background:rgba(12,12,12,0.06)}
      .theme-dark.visual-transparent .drag-handle{background:linear-gradient(180deg,#2a2a2a,#171717);border:1px solid rgba(255,255,255,0.04);box-shadow:0 4px 12px rgba(0,0,0,0.6);color:var(--text)}
    </style>
  </body>
</html>
