<!-- ui_tool.html — 浮动工具栏 UI 模块：按钮/子菜单/资源库弹窗（由 tool_bar/ui-tools.js 驱动） -->
<div class="floating-panel" role="toolbar" aria-label="绘图控制">
  <div id="dragHandle" class="drag-handle" title="拖动工具栏" role="button" tabindex="0" aria-label="拖动工具栏">≡</div>
  <div class="panel-section tools">
    <div class="tool">
      <button id="pointerTool" class="tool-btn" title="选择(暂无功能)" aria-label="选择(暂无功能)">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M5 3.059a1 1 0 0 1 1.636-.772l11.006 9.062c.724.596.302 1.772-.636 1.772h-5.592a1.5 1.5 0 0 0-1.134.518l-3.524 4.073c-.606.7-1.756.271-1.756-.655zm12.006 9.062L6 3.059v13.998l3.524-4.072a2.5 2.5 0 0 1 1.89-.864z"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="colorTool" class="tool-btn" title="画笔" aria-label="画笔">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M17.18 2.926a2.975 2.975 0 0 0-4.26-.054l-9.375 9.375a2.44 2.44 0 0 0-.655 1.194l-.878 3.95a.5.5 0 0 0 .597.597l3.926-.873a2.5 2.5 0 0 0 1.234-.678l7.98-7.98l.337.336a1 1 0 0 1 0 1.414l-.94.94a.5.5 0 0 0 .708.706l.939-.94a2 2 0 0 0 0-2.828l-.336-.336l.67-.67a2.975 2.975 0 0 0 .052-4.153m-3.553.653a1.975 1.975 0 0 1 2.793 2.793L7.062 15.73a1.5 1.5 0 0 1-.744.409l-3.16.702l.708-3.183a1.43 1.43 0 0 1 .387-.704z"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="eraserTool" class="tool-btn" title="橡皮/更多" aria-label="橡皮/更多">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="m15.87 2.669l4.968 4.968a2.25 2.25 0 0 1 0 3.182l-8.682 8.68l6.098.001a.75.75 0 0 1 .743.648l.007.102a.75.75 0 0 1-.648.743l-.102.007l-8.41.001a2.24 2.24 0 0 1-1.714-.655l-4.969-4.969a2.25 2.25 0 0 1 0-3.182l9.527-9.526a2.25 2.25 0 0 1 3.182 0M5.708 11.768l-1.486 1.488a.75.75 0 0 0 0 1.06l4.969 4.969c.146.146.338.22.53.22l.029-.005l.038.002a.75.75 0 0 0 .463-.217l1.486-1.487zm8.04-8.039L6.77 10.707l6.03 6.03l6.979-6.978a.75.75 0 0 0 0-1.061L14.81 3.729a.75.75 0 0 0-1.06 0"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="videoBoothTool" class="tool-btn" title="视频展台" aria-label="视频展台">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11zM10 15l-2.25-3l-1.75 2.26V10h8v4.5z"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="exitTool" class="tool-btn" title="进入智能批注模式" aria-label="进入智能批注模式">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M8.5 9A1.5 1.5 0 0 0 10 7.5v-4A1.5 1.5 0 0 0 8.5 2h-6A1.5 1.5 0 0 0 1 3.5v4a1.5 1.5 0 0 0 1 1.415l.019.006c.15.051.313.079.481.079zm6.75-3H11V5h4.25A2.75 2.75 0 0 1 18 7.75v6.5A2.75 2.75 0 0 1 15.25 17H4.75A2.75 2.75 0 0 1 2 14.25v-4.3q.243.05.5.05H3v4.25c0 .966.784 1.75 1.75 1.75h10.5A1.75 1.75 0 0 0 17 14.25v-6.5A1.75 1.75 0 0 0 15.25 6M14 12.293l-2.646-2.647a.5.5 0 0 0-.708.708L13.293 13H11.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.497V10.5a.5.5 0 0 0-1 0z"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="featureLibraryTool" class="tool-btn" title="从功能库添加到工具栏" aria-label="从功能库添加到工具栏">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><g fill="currentColor"><path d="M5.75 4A2.75 2.75 0 0 0 3 6.75v10.5A2.75 2.75 0 0 0 5.75 20h12.5A2.75 2.75 0 0 0 21 17.25V6.75A2.75 2.75 0 0 0 18.25 4zM4.5 6.75c0-.69.56-1.25 1.25-1.25h12.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H5.75c-.69 0-1.25-.56-1.25-1.25z"/><path d="M8 8.25c0-.41.34-.75.75-.75h6.5a.75.75 0 0 1 0 1.5h-6.5A.75.75 0 0 1 8 8.25m0 3c0-.41.34-.75.75-.75h6.5a.75.75 0 0 1 0 1.5h-6.5A.75.75 0 0 1 8 11.25m0 3c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 8 14.25"/></g></svg>
      </button>
    </div>

    <div class="tool">
      <button id="moreTool" class="tool-btn" title="更多" aria-label="更多">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M4.5 17a1.5 1.5 0 0 1-1.493-1.355L3 15.501v-11a1.5 1.5 0 0 1 1.356-1.493L4.5 3H9a1.5 1.5 0 0 1 1.493 1.355l.007.145v.254l2.189-2.269a1.5 1.5 0 0 1 2.007-.138l.116.101l2.757 2.725a1.5 1.5 0 0 1 .111 2.011l-.103.116l-2.311 2.2h.234a1.5 1.5 0 0 1 1.493 1.356L17 11v4.5a1.5 1.5 0 0 1-1.355 1.493L15.5 17zm5-6.5H4v5a.5.5 0 0 0 .326.47l.084.023l.09.008h5zm6 0h-5V16h5a.5.5 0 0 0 .492-.41L16 15.5V11a.5.5 0 0 0-.41-.491zm-5-2.79V9.5h1.79zM9 4H4.5a.5.5 0 0 0-.492.411L4 4.501v5h5.5v-5a.5.5 0 0 0-.326-.469L9.09 4.01zm5.122-.826a.5.5 0 0 0-.645-.053l-.068.06l-2.616 2.713a.5.5 0 0 0-.057.623l.063.078l2.616 2.615a.5.5 0 0 0 .62.07l.078-.061l2.758-2.627a.5.5 0 0 0 .054-.638l-.059-.069z"/></svg>
      </button>
    </div>

    <div class="tool">
      <button id="collapseTool" class="tool-btn" title="折叠/展开" aria-label="折叠/展开">⋯</button>
    </div>

    <div class="tool foldable">
      <div style="display:flex;gap:8px;align-items:center">
        <button id="undoBtn" class="tool-btn" title="撤销" aria-label="撤销">⤺</button>
        <button id="redoBtn" class="tool-btn" title="重做" aria-label="重做">⤻</button>
      </div>
    </div>
  </div>

  <div class="submenu colors" id="colorMenu" aria-hidden="true" data-pinned="false">
    <div class="submenu-body">
      <div class="colorRow">
        <button class="color" data-color="#FFFFFF" style="background:#FFFFFF;border:1px solid #ccc" title="白 (#FFFFFF)"></button>
        <button class="color" data-color="#000000" style="background:#000000" title="黑 (#000000)"></button>
        <button class="color" data-color="#C50F1F" style="background:#C50F1F" title="红 (#C50F1F)"></button>
        <button class="color" data-color="#FFB6C1" style="background:#FFB6C1" title="淡粉色 (#FFB6C1)"></button>
        <button class="color" data-color="#FF8C00" style="background:#FF8C00" title="橙 (#FF8C00)"></button>
        <button class="color" data-color="#FFC83D" style="background:#FFC83D" title="黄 (#FFC83D)"></button>
        <button class="color" data-color="#107C10" style="background:#107C10" title="绿 (#107C10)"></button>
        <button class="color" data-color="#00B7C3" style="background:#00B7C3" title="青 (#00B7C3)"></button>
        <button class="color" data-color="#005A9E" style="background:#005A9E" title="蓝 (#005A9E)"></button>
        <button class="color" data-color="#5C2E91" style="background:#5C2E91" title="紫 (#5C2E91)"></button>
      </div>
      <div class="sizeControl">
        <label>大小 <input id="size" type="range" min="1" max="50" value="4"></label>
      </div>
      <div class="modeLabel" id="penModeLabel">笔: 黑 / 4</div>
    </div>
    <div class="submenu-footer">
      <button class="submenu-drag-handle" title="拖动子菜单">⋮</button>
      <button class="submenu-pin" title="固定/取消固定">📌</button>
    </div>
  </div>

  <div class="submenu actions" id="eraserMenu" aria-hidden="true" data-pinned="false">
    <div class="submenu-body">
      <div class="sizeControl">
        <label>橡皮大小 <input id="eraserSize" type="range" min="1" max="100" value="20"></label>
      </div>
      <div class="eraseModes" style="padding-top:6px;display:flex;gap:6px;justify-content:center;flex-wrap:wrap">
        <button id="erasePixel" class="mode-btn erase-mode-btn" data-mode="pixel" title="像素擦除">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="currentColor"><path d="M15.84 2.661a2.25 2.25 0 0 0-3.19-.023l-9.598 9.508a2.25 2.25 0 0 0 .007 3.204l5.1 5.008a2.25 2.25 0 0 0 3.175-.023l.215-.217a6.5 6.5 0 0 1-.478-1.65l-.803.812a.75.75 0 0 1-1.059.008L4.11 14.28a.75.75 0 0 1-.002-1.068l1.529-1.515l5.377 5.377a6.5 6.5 0 0 1 .362-1.759l-4.673-4.673l7.003-6.938a.75.75 0 0 1 1.064.007l4.91 5.009a.75.75 0 0 1-.003 1.052l-1.276 1.29c.58.08 1.135.237 1.655.46l.687-.695a2.25 2.25 0 0 0 .008-3.158z"/><path d="M19.289 12.297A5.5 5.5 0 1 1 17.473 12m.027 0a5.5 5.5 0 0 1 1.789.297Zm0 0h-.027Z"/></g></svg>
          像素擦除
        </button>
        <button id="eraseStroke" class="mode-btn erase-mode-btn" data-mode="stroke" title="整笔删除">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="m15.87 2.669l4.968 4.968a2.25 2.25 0 0 1 0 3.182l-8.682 8.68l6.098.001a.75.75 0 0 1 .743.648l.007.102a.75.75 0 0 1-.648.743l-.102.007l-8.41.001a2.24 2.24 0 0 1-1.714-.655l-4.969-4.969a2.25 2.25 0 0 1 0-3.182l9.527-9.526a2.25 2.25 0 0 1 3.182 0M5.708 11.768l-1.486 1.488a.75.75 0 0 0 0 1.06l4.969 4.969c.146.146.338.22.53.22l.029-.005l.038.002a.75.75 0 0 0 .463-.217l1.486-1.487zm8.04-8.039L6.77 10.707l6.03 6.03l6.979-6.978a.75.75 0 0 0 0-1.061L14.81 3.729a.75.75 0 0 0-1.06 0"/></svg>
          整笔删除
        </button>
        <button id="eraseRect" class="mode-btn erase-mode-btn" data-mode="rect" title="矩形擦除">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="currentColor"><path d="M2 6.75A2.75 2.75 0 0 1 4.75 4h14.5A2.75 2.75 0 0 1 22 6.75v5.786l-.8-.801a2.5 2.5 0 0 0-.7-.493V6.75c0-.69-.56-1.25-1.25-1.25H4.75c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h7.265a2.5 2.5 0 0 0 .561 1.5H4.75A2.75 2.75 0 0 1 2 17.25z"/><path d="M20.492 12.442a1.5 1.5 0 0 0-2.121 0l-3.111 3.11l4.207 4.208l3.11-3.111a1.5 1.5 0 0 0 0-2.122zm-7.039 4.918l1.1-1.1l4.207 4.207l-1.1 1.1a1.5 1.5 0 0 1-2.121 0l-2.086-2.086a1.5 1.5 0 0 1 0-2.122"/></g></svg>
          矩形擦除
        </button>
      </div>
      <div class="modeLabel" id="eraserModeLabel">橡皮模式: 像素擦除</div>
      <div style="padding-top:6px">
        <button id="clear" title="清空画布">清除页面</button>
      </div>
    </div>
    <div class="submenu-footer">
      <button class="submenu-drag-handle" title="拖动子菜单">⋮</button>
      <button class="submenu-pin" title="固定/取消固定">📌</button>
    </div>
  </div>

  <div class="submenu actions" id="moreMenu" aria-hidden="true" data-pinned="false">
    <div class="submenu-content more-split">
      <div class="more-region more-left" aria-label="功能库">
        <div class="more-title">功能库</div>
        <div class="submenu-quick" role="toolbar" aria-label="功能库快捷功能">
          <div class="submenu-quick-grid" id="moreMenuQuickGrid"></div>
        </div>
      </div>
      <div class="more-divider" aria-hidden="true"></div>
      <div class="more-region more-right" aria-label="更多设置">
        <div class="more-title">更多设置</div>
        <div class="submenu-body">
          <button id="noteManagerBtn" class="mode-btn">笔记管理</button>
          <button id="settingsBtn" class="mode-btn">设置</button>
          <button id="pluginManagerBtn" class="mode-btn">插件</button>
          <button id="aboutBtn" class="mode-btn">关于</button>
          <button id="restartWhiteboardBtn" class="mode-btn">重启白板</button>
        </div>
      </div>
    </div>
    <div class="submenu-footer">
      <button class="submenu-drag-handle" title="拖动子菜单">⋮</button>
      <button class="submenu-pin" title="固定/取消固定">📌</button>
    </div>
  </div>
</div>

<div id="resourceModal" class="settings-modal resource-modal" role="dialog" aria-hidden="true">
  <div class="settings-backdrop"></div>
  <div class="settings-panel resource-panel" aria-modal="true" aria-label="资源库管理">
    <div class="settings-header">
      <h3>资源库</h3>
      <button id="closeResourceModal" class="tool-btn" aria-label="关闭">✕</button>
    </div>
    <div class="settings-body resource-body">
      <div class="resource-layout">
        <div class="resource-sort">
          <div class="resource-hint">拖拽排序，实时预览</div>
          <div id="resourceList" class="resource-list" role="list"></div>
        </div>
        <div class="resource-preview" aria-label="预览">
          <div class="resource-preview-title">预览</div>
          <div id="resourcePreviewGrid" class="resource-preview-grid"></div>
        </div>
      </div>
    </div>
    <div class="resource-footer">
      <button id="resourceResetBtn" class="mode-btn" type="button">恢复默认</button>
      <button id="resourceSaveBtn" class="md3-button filled" type="button">保存排序</button>
    </div>
  </div>
</div>
