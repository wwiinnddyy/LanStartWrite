<!-- setting_ui.html: settings modal fragment -->
<div id="settingsModal" class="settings-modal" role="dialog" aria-hidden="true">
  <div class="settings-backdrop"></div>
  <div class="settings-panel settings-gnome" aria-modal="true" aria-label="设置">
    <div class="settings-header">
      <h3>设置</h3>
      <button id="closeSettings" class="tool-btn">✕</button>
    </div>
    <div class="settings-body settings-body-gnome">
      <div class="settings-shell">
        <div class="settings-sidebar" role="tablist" aria-label="设置分类">
          <button class="settings-tab" type="button" role="tab" id="settingsTab-general" data-tab="general" aria-controls="settingsPanel-general" aria-selected="true" tabindex="0">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M19.14,12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.11-.2-.35-.28-.56-.2l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.03-.22-.22-.38-.44-.38h-3.84c-.22,0-.41.16-.44.38l-.36,2.54c-.59.24-1.13.56-1.62.94l-2.39-.96c-.2-.08-.45,0-.56.2l-1.92,3.32c-.12.2-.07.47.12.61l2.03,1.58c-.05.3-.07.63-.07.94s.02.64.07.94l-2.03,1.58c-.18.14-.23.41-.12.61l1.92,3.32c.11.2.35.28.56.2l2.39-.96c.5.38,1.03.7,1.62.94l.36,2.54c.03.22.22.38.44.38h3.84c.22,0,.41-.16.44-.38l.36-2.54c.59-.24,1.13-.56,1.62-.94l2.39.96c.2.08.45,0,.56-.2l1.92-3.32c.11-.2.06-.47-.12-.61l-2.02-1.58ZM12,15.6c-1.99,0-3.6-1.61-3.6-3.6s1.61-3.6,3.6-3.6,3.6,1.61,3.6,3.6-1.61,3.6-3.6,3.6Z"/></svg>
            <span class="settings-tab-text">常规</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-appearance" data-tab="appearance" aria-controls="settingsPanel-appearance" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 22c4.42 0 8-3.58 8-8c0-1.1-.22-2.14-.62-3.1c-.37-.9-1.41-1.32-2.3-.95l-1.39.57c-.51.21-1.1-.03-1.31-.55l-.57-1.39c-.37-.9-1.41-1.32-2.3-.95l-1.39.57c-.51.21-1.1-.03-1.31-.55l-.57-1.39c-.37-.9-1.41-1.32-2.3-.95C3.24 4.8 2 7.28 2 10c0 6.63 3.37 12 10 12Zm6-8c0 3.31-2.69 6-6 6c-2.89 0-5.45-2.06-6.4-4.98c.35.13.73.2 1.12.2c.59 0 1.16-.11 1.69-.33l1.39-.57l.57 1.39c.37.9 1.41 1.32 2.3.95l1.39-.57l.57 1.39c.37.9 1.41 1.32 2.3.95l1.06-.44c.02.14.02.27.02.41Z"/></svg>
            <span class="settings-tab-text">外观</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-input" data-tab="input" aria-controls="settingsPanel-input" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M7 24c-1.1 0-2-.9-2-2V11c0-1.1.9-2 2-2s2 .9 2 2v11c0 1.1-.9 2-2 2Zm10-11c1.1 0 2-.9 2-2V2c0-1.1-.9-2-2-2s-2 .9-2 2v9c0 1.1.9 2 2 2Zm-5 7c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2s-2 .9-2 2v12c0 1.1.9 2 2 2Z"/></svg>
            <span class="settings-tab-text">输入</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-shortcuts" data-tab="shortcuts" aria-controls="settingsPanel-shortcuts" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M20 5H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2ZM7 17H5v-2h2v2Zm0-4H5v-2h2v2Zm0-4H5V7h2v2Zm4 8H9v-2h2v2Zm0-4H9v-2h2v2Zm0-4H9V7h2v2Zm4 8h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V7h2v2Zm4 8h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V7h2v2Z"/></svg>
            <span class="settings-tab-text">快捷键</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-toolbar" data-tab="toolbar" aria-controls="settingsPanel-toolbar" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 5.75A1.75 1.75 0 0 1 5.75 4h12.5A1.75 1.75 0 0 1 20 5.75v2.5A1.75 1.75 0 0 1 18.25 10H5.75A1.75 1.75 0 0 1 4 8.25Zm0 8.5A1.75 1.75 0 0 1 5.75 12h7.5A1.75 1.75 0 0 1 15 13.75v4.5A1.75 1.75 0 0 1 13.25 20h-7.5A1.75 1.75 0 0 1 4 18.25Z"/></svg>
            <span class="settings-tab-text">工具栏控件</span>
          </button>
        </div>
        <div class="settings-content" aria-live="polite" aria-busy="false">
          <div class="settings-loading" hidden aria-hidden="true">
            <div class="settings-spinner" aria-hidden="true"></div>
            <div class="settings-loading-text">加载中…</div>
          </div>
          <div class="settings-content-inner">
            <div class="settings-page active" id="settingsPanel-general" data-tab="general" role="tabpanel" aria-labelledby="settingsTab-general">
              <div class="settings-cards">
                <section class="settings-card" aria-label="工具栏">
                  <div class="settings-card-title">工具栏</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optAutoResize"> <span>自动调整工具栏宽度</span></label>
                    <label class="settings-control"><input type="checkbox" id="optCollapsed"> <span>启动时折叠工具栏</span></label>
                    <label class="settings-control"><input type="checkbox" id="optTooltips"> <span>显示工具提示</span></label>
                  </div>
                </section>
                <section class="settings-card" aria-label="设置预览">
                  <div class="settings-card-title">预览</div>
                  <div class="settings-card-body">
                    <div class="settings-row">
                      <button id="previewSettings" class="mode-btn" type="button">预览设置</button>
                      <button id="revertPreview" class="mode-btn" type="button">撤销预览</button>
                    </div>
                    <div id="historyStateDisplay" class="settings-hint" aria-live="polite">撤销: — 重做: —</div>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-appearance" data-tab="appearance" role="tabpanel" aria-labelledby="settingsTab-appearance" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="主题与样式">
                  <div class="settings-card-title">主题与样式</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">主题</span>
                      <select id="optTheme">
                        <option value="system">跟随系统</option>
                        <option value="light">日间</option>
                        <option value="dark">夜间</option>
                        <option value="high-contrast">高对比度</option>
                        <option value="custom">自定义</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">界面风格</span>
                      <select id="optDesignLanguage">
                        <option value="fluent">Fluent设计风格</option>
                        <option value="material3">Material 3 Expressive设计风格</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">视觉效果</span>
                      <select id="optVisualStyle">
                        <option value="solid">实心</option>
                        <option value="blur">模糊</option>
                        <option value="transparent">透明</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">云母强度 <span id="micaIntensityText">60%</span></span>
                      <input id="optMicaIntensity" type="range" min="0" max="100" step="5" value="60" />
                    </label>
                  </div>
                </section>
                <section class="settings-card" aria-label="自定义主题">
                  <div class="settings-card-title">自定义主题</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">Primary</span>
                      <input type="color" id="optThemePrimary" value="#2B7CFF" aria-label="Primary 颜色">
                    </label>
                    <label class="settings-field">
                      <span class="settings-field-label">Secondary</span>
                      <input type="color" id="optThemeSecondary" value="#535F70" aria-label="Secondary 颜色">
                    </label>
                    <label class="settings-field">
                      <span class="settings-field-label">背景</span>
                      <input type="color" id="optThemeBackground" value="#FFFFFF" aria-label="背景颜色">
                    </label>
                    <div class="settings-divider"></div>
                    <div class="settings-row">
                      <button id="exportThemeBtn" class="mode-btn" type="button">导出 .lantheme</button>
                      <button id="importThemeBtn" class="mode-btn" type="button">导入 .lantheme</button>
                      <button id="resetThemeBtn" class="mode-btn" type="button">重置主题</button>
                      <input id="themeFileInput" type="file" accept=".lantheme,application/json" style="display:none" />
                    </div>
                    <div class="settings-divider"></div>
                    <div class="settings-hint">实时预览</div>
                    <div id="themePreview" class="theme-preview" aria-label="主题预览">
                      <div class="theme-preview-card">
                        <div class="theme-preview-title">示例卡片</div>
                        <div class="theme-preview-body">正文示例文本 16px / 行高 1.5</div>
                        <div class="theme-preview-actions">
                          <button class="mode-btn" type="button">次按钮</button>
                          <button class="md3-button filled" type="button">主按钮</button>
                        </div>
                      </div>
                    </div>
                    <div class="settings-row" style="padding-top:6px">
                      <button id="contrastReportBtn" class="mode-btn" type="button">对比度检查</button>
                      <button id="perfCheckBtn" class="mode-btn" type="button">性能自检</button>
                    </div>
                    <pre id="themeReportOut" class="theme-report" aria-live="polite"></pre>
                  </div>
                </section>
                <section class="settings-card" aria-label="画布">
                  <div class="settings-card-title">画布</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">画布颜色</span>
                      <select id="optCanvasColor">
                        <option value="white">白色</option>
                        <option value="black">黑色</option>
                        <option value="chalkboard">黑板绿</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">PDF默认打开模式</span>
                      <select id="optPdfDefaultMode">
                        <option value="window">窗口模式</option>
                        <option value="fullscreen">全屏模式</option>
                      </select>
                    </label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-input" data-tab="input" role="tabpanel" aria-labelledby="settingsTab-input" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="触控与书写">
                  <div class="settings-card-title">触控与书写</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optMultiTouchPen"> <span>触摸多指书写</span></label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">批注默认笔颜色</span>
                      <input type="color" id="optAnnotationPenColor" value="#FF0000" aria-label="批注默认笔颜色">
                    </label>
                  </div>
                </section>
                <section class="settings-card" aria-label="笔锋功能">
                  <div class="settings-card-title">笔锋功能</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optPenTailEnabled"> <span>启用末端采样笔锋</span></label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">参数预设</span>
                      <select id="optPenTailProfile">
                        <option value="standard">标准</option>
                        <option value="calligraphy">书法</option>
                        <option value="speed">速记</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">笔锋强度 <span id="penTailIntensityText">50%</span></span>
                      <input id="optPenTailIntensity" type="range" min="0" max="100" step="1" value="50" aria-label="笔锋强度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">采样点数量 <span id="penTailSamplePointsText">10</span></span>
                      <input id="optPenTailSamplePoints" type="range" min="5" max="20" step="1" value="10" aria-label="采样点数量">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">速度敏感度 <span id="penTailSpeedText">100%</span></span>
                      <input id="optPenTailSpeedSensitivity" type="range" min="0" max="200" step="5" value="100" aria-label="速度敏感度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">压力敏感度 <span id="penTailPressureText">100%</span></span>
                      <input id="optPenTailPressureSensitivity" type="range" min="0" max="200" step="5" value="100" aria-label="压力敏感度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">笔锋形状</span>
                      <select id="optPenTailShape">
                        <option value="sharp">锐利</option>
                        <option value="round">圆润</option>
                        <option value="natural">自然</option>
                        <option value="custom">自定义</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <div class="settings-hint" style="padding-bottom:6px">实时预览</div>
                    <canvas id="penTailPreview" class="pen-tail-preview" width="520" height="150" aria-label="笔锋预览"></canvas>
                  </div>
                </section>
                <section class="settings-card" aria-label="智能功能">
                  <div class="settings-card-title">智能功能</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optSmartInk"> <span>图形与直线智能识别</span></label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-shortcuts" data-tab="shortcuts" role="tabpanel" aria-labelledby="settingsTab-shortcuts" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="快捷键">
                  <div class="settings-card-title">快捷键</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">撤销</span>
                      <input id="keyUndo" type="text" placeholder="Ctrl+Z" maxlength="20" inputmode="text" aria-label="撤销快捷键">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">重做</span>
                      <input id="keyRedo" type="text" placeholder="Ctrl+Y" maxlength="20" inputmode="text" aria-label="重做快捷键">
                    </label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-toolbar" data-tab="toolbar" role="tabpanel" aria-labelledby="settingsTab-toolbar" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="浮动工具栏控件">
                  <div class="settings-card-title">浮动工具栏控件</div>
                  <div class="settings-card-body">
                    <div class="resource-layout">
                      <div class="resource-sort">
                        <div class="resource-hint">拖拽排序，点击隐藏/显示按钮，下方实时预览</div>
                        <div id="toolbarLayoutList" class="resource-list" role="list"></div>
                      </div>
                      <div class="resource-preview" aria-label="预览">
                        <div class="resource-preview-title">工具栏预览</div>
                        <div id="toolbarLayoutPreview" class="resource-preview-grid"></div>
                      </div>
                    </div>
                    <div class="settings-row" style="margin-top:8px">
                      <button id="toolbarLayoutReset" class="mode-btn" type="button">恢复默认布局</button>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="settings-footer">
      <button id="resetSettings">重置为默认</button>
      <button id="saveSettings">保存</button>
    </div>
  </div>
</div>

<div id="aboutModal" class="settings-modal" role="dialog" aria-hidden="true">
  <div class="settings-backdrop"></div>
  <div class="settings-panel">
    <div class="settings-header">
      <h3>关于</h3>
      <button id="closeAbout" class="tool-btn">✕</button>
    </div>
    <div class="settings-body" style="text-align:center">
      <div style="padding:12px 8px">
        <div style="font-size:18px;font-weight:700">LanStartWrite</div>
        <div style="padding-top:6px;color:#555">揽星书写</div>
        <div style="padding-top:12px;font-size:14px;color:#888">版本 0.2.1</div>
        <div style="padding-top:4px;font-size:14px;color:#888">Doctor</div>
      </div>
    </div>
  </div>
</div>

<div id="pluginModal" class="settings-modal" role="dialog" aria-hidden="true" aria-label="插件管理">
  <div class="settings-backdrop"></div>
  <div class="settings-panel plugin-panel">
    <div class="settings-header">
      <h3>插件管理</h3>
      <button id="closePluginModal" class="tool-btn" aria-label="关闭">✕</button>
    </div>
    <div class="settings-body plugin-body">
      <div class="plugin-install-row">
        <input id="pluginFileInput" type="file" accept=".lanmod" style="display:none" />
        <button id="pluginInstallBtn" class="mode-btn">安装插件</button>
        <button id="pluginRefreshBtn" class="mode-btn">刷新</button>
        <div id="pluginInstallStatus" class="plugin-status" aria-live="polite"></div>
      </div>
      <div id="pluginDropZone" class="plugin-drop" tabindex="0" role="button" aria-label="拖放或选择插件安装">
        <div class="plugin-drop-title">拖放 .lanmod 到这里安装</div>
        <div class="plugin-drop-sub">或点击“安装插件”选择文件</div>
        <progress id="pluginInstallProgress" value="0" max="100" class="plugin-progress" aria-label="安装进度"></progress>
      </div>
      <div class="plugin-list-head">
        <div>已安装插件</div>
        <div class="plugin-list-hint">拖动排序</div>
      </div>
      <div id="pluginList" class="plugin-list" role="list"></div>
    </div>
  </div>
</div>
