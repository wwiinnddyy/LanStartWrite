<!-- setting_ui.html: settings modal fragment -->
<style>
  @font-face{
    font-family:'MiSans';
    src:local('MiSans'),local('MiSans-Regular'),local('System Font');
    font-weight:400;
    font-display:swap;
  }
  @font-face{
    font-family:'MiSans';
    src:local('MiSans-Bold'),local('System Font Bold');
    font-weight:700;
    font-display:swap;
  }

  .settings-modal{
    --ls-font-family:"MiSans",system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
    --ls-font-size-base:15px;
    --ls-line-height:1.5;
    --ls-ease:cubic-bezier(0.2,0,0,1);
    --ls-theme-dur:300ms;
    --ls-press-dur:150ms;
    --ls-motion-dur:400ms;
    --ls-motion-ease:cubic-bezier(0.2,0,0,1);
    --ls-radius-sm:8px;
    --ls-radius-md:16px;
    --ls-radius-lg:24px;
    --ls-sys-color-primary:#3478F6;
    --ls-sys-color-on-primary:#fff;
    --ls-sys-color-error:#FF453A;
    --ls-shadow-sm:0 2px 8px rgba(0,0,0,0.04);
    --ls-shadow-md:0 8px 24px rgba(0,0,0,0.06);
    --ls-shadow-lg:0 16px 40px rgba(0,0,0,0.08);

    --ls-sys-color-secondary:#535f70;
    --ls-sys-color-surface:#F2F3F5;
    --ls-sys-color-on-surface:#191919;
    --ls-sys-color-background:#F2F3F5;
    --ls-sys-color-outline:#E5E6EB;
    --ls-sys-color-surface-variant:#FFFFFF;

    --ls-card-bg:rgba(255,255,255,0.95);
    --ls-glass-border:rgba(255,255,255,0.6);
    --ls-btn-bg:rgba(255,255,255,0.8);
    --ls-btn-fg:#191919;
    --ls-btn-border:rgba(0,0,0,0.05);
    --ls-btn-hover-bg:#FFFFFF;
    --ls-btn-hover-shadow:0 4px 12px rgba(0,0,0,0.08);
    --ls-btn-active-bg:#F0F0F0;
    --ls-btn-active-scale:0.95;

    --text-high:rgba(0,0,0,0.9);
    --text-medium:rgba(0,0,0,0.6);
    --text-disabled:rgba(0,0,0,0.3);
  }

  .theme-dark .settings-modal{
    --ls-sys-color-surface:#0E0E10;
    --ls-sys-color-on-surface:#F7F7F7;
    --ls-sys-color-background:#0E0E10;
    --ls-sys-color-outline:rgba(255,255,255,0.10);
    --ls-sys-color-surface-variant:rgba(255,255,255,0.06);

    --ls-card-bg:rgba(18,18,18,0.72);
    --ls-glass-border:rgba(255,255,255,0.10);
    --ls-btn-bg:rgba(255,255,255,0.08);
    --ls-btn-fg:#F7F7F7;
    --ls-btn-border:rgba(255,255,255,0.10);
    --ls-btn-hover-bg:rgba(255,255,255,0.12);
    --ls-btn-hover-shadow:0 4px 14px rgba(0,0,0,0.40);
    --ls-btn-active-bg:rgba(255,255,255,0.16);

    --text-high:rgba(255,255,255,0.92);
    --text-medium:rgba(255,255,255,0.64);
    --text-disabled:rgba(255,255,255,0.36);
  }

  .settings-modal{
    font-family:var(--ls-font-family);
    font-size:var(--ls-font-size-base);
    line-height:var(--ls-line-height);
    color:var(--text-high);
  }

  .settings-backdrop{
    background:rgba(0,0,0,0.25);
    backdrop-filter:blur(6px);
    -webkit-backdrop-filter:blur(6px);
  }

  .settings-panel{
    width:min(980px,calc(100vw - 32px));
    height:min(720px,calc(100vh - 32px));
    background:rgba(255,255,255,0.65);
    backdrop-filter:blur(24px) saturate(1.2);
    -webkit-backdrop-filter:blur(24px) saturate(1.2);
    border:1px solid var(--ls-glass-border);
    border-radius:var(--ls-radius-lg);
    box-shadow:var(--ls-shadow-lg);
    overflow:hidden;
  }

  .theme-dark .settings-panel{
    background:rgba(18,18,18,0.55);
  }

  .settings-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:18px 18px 12px;
  }

  .settings-header h3{
    margin:0;
    font-size:18px;
    font-weight:700;
    letter-spacing:0.2px;
  }

  .settings-modal .tool-btn{
    width:36px;
    height:36px;
    border-radius:var(--ls-radius-sm);
    border:1px solid var(--ls-btn-border);
    background:var(--ls-btn-bg);
    color:var(--ls-btn-fg);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:transform 180ms var(--ls-ease),box-shadow 180ms var(--ls-ease),background-color 180ms var(--ls-ease);
  }
  .settings-modal .tool-btn:hover,
  .settings-modal .tool-btn[data-force-hover="true"]{
    background:var(--ls-btn-hover-bg);
    box-shadow:var(--ls-btn-hover-shadow);
    transform:translateY(-1px);
  }
  .settings-modal .tool-btn:active,
  .settings-modal .tool-btn[data-force-active="true"]{
    background:var(--ls-btn-active-bg);
    transform:scale(var(--ls-btn-active-scale));
  }

  .settings-body{
    height:calc(100% - 62px - 64px);
    padding:0 12px 12px;
  }

  .settings-shell{
    display:grid;
    grid-template-columns:240px 1fr;
    gap:8px;
    height:100%;
  }

  .settings-sidebar{
    background:rgba(255,255,255,0.4);
    border:1px solid var(--ls-glass-border);
    border-radius:var(--ls-radius-md);
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:6px;
    overflow:auto;
  }
  .theme-dark .settings-sidebar{
    background:rgba(255,255,255,0.04);
    border-color:rgba(255,255,255,0.08);
  }

  .settings-content{
    background:var(--ls-sys-color-background);
    border-radius:var(--ls-radius-md);
    overflow:hidden;
    border:1px solid var(--ls-sys-color-outline);
  }

  .settings-content-inner{
    height:100%;
    overflow:auto;
    padding:18px;
  }

  .settings-tab{
    display:flex;
    align-items:center;
    gap:10px;
    width:100%;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid transparent;
    background:transparent;
    color:var(--text-medium);
    cursor:pointer;
    transition:background-color 180ms var(--ls-ease),color 180ms var(--ls-ease),transform 180ms var(--ls-ease);
    text-align:left;
  }
  .settings-tab:hover{
    background:rgba(52,120,246,0.10);
    color:var(--text-high);
  }
  .settings-tab[aria-selected="true"], .settings-tab.active{
    background:rgba(52,120,246,0.16);
    color:var(--ls-sys-color-primary);
    font-weight:700;
  }
  .settings-tab:active{
    transform:scale(0.98);
  }
  .settings-tab svg{flex:0 0 auto;opacity:0.95}
  .settings-tab-text{font-size:14px}

  .settings-cards{display:flex;flex-direction:column;gap:14px}

  .settings-card{
    background:var(--ls-card-bg);
    border:1px solid var(--ls-glass-border);
    border-radius:var(--ls-radius-md);
    box-shadow:var(--ls-shadow-md);
    overflow:hidden;
  }

  .settings-card-title{
    padding:16px 18px 0;
    font-weight:700;
    color:var(--text-high);
    font-size:15px;
  }

  .settings-card-body{
    padding:12px 18px 16px;
    color:var(--text-medium);
  }

  .settings-divider{
    height:1px;
    background:var(--ls-sys-color-outline);
    margin:12px 0;
  }

  .settings-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

  .settings-modal .mode-btn{
    padding:10px 16px;
    border-radius:var(--ls-radius-sm);
    border:1px solid var(--ls-btn-border);
    background:var(--ls-btn-bg);
    color:var(--ls-btn-fg);
    cursor:pointer;
    font-size:14px;
    font-weight:600;
    backdrop-filter:blur(10px);
    -webkit-backdrop-filter:blur(10px);
    transition:transform 180ms var(--ls-ease),box-shadow 180ms var(--ls-ease),background-color 180ms var(--ls-ease),border-color 180ms var(--ls-ease);
    user-select:none;
    -webkit-user-select:none;
    touch-action:manipulation;
  }
  .settings-modal .mode-btn:hover,
  .settings-modal .mode-btn[data-force-hover="true"]{
    background:var(--ls-btn-hover-bg);
    box-shadow:var(--ls-btn-hover-shadow);
    transform:translateY(-1px);
  }
  .settings-modal .mode-btn:active,
  .settings-modal .mode-btn[data-force-active="true"]{
    background:var(--ls-btn-active-bg);
    transform:scale(var(--ls-btn-active-scale));
  }
  .settings-modal .mode-btn:focus-visible{
    outline:2px solid rgba(52,120,246,0.55);
    outline-offset:2px;
  }
  .settings-modal .mode-btn-primary{
    background:var(--ls-sys-color-primary);
    border-color:transparent;
    color:var(--ls-sys-color-on-primary);
  }
  .settings-modal .mode-btn-primary:hover,
  .settings-modal .mode-btn-primary[data-force-hover="true"]{
    background:color-mix(in srgb,var(--ls-sys-color-primary) 86%, #000);
  }
  .settings-modal .mode-btn-danger{
    background:rgba(255,69,58,0.10);
    border-color:rgba(255,69,58,0.24);
    color:var(--ls-sys-color-error);
  }
  .settings-modal .mode-btn-danger:hover,
  .settings-modal .mode-btn-danger[data-force-hover="true"]{
    background:rgba(255,69,58,0.14);
  }

  .settings-control{display:flex;gap:10px;align-items:center;color:var(--text-high)}
  .settings-field{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .settings-field-label{color:var(--text-medium);font-size:13px;font-weight:600}
  .settings-hint{color:var(--text-medium);font-size:13px}
  .settings-field select,
  .settings-field input[type="text"],
  .settings-field input[type="color"],
  .settings-field input[type="range"]{
    font:inherit;
  }

  .settings-footer{
    height:64px;
    padding:0 18px;
    display:flex;
    align-items:center;
    justify-content:flex-end;
    gap:12px;
    background:rgba(255,255,255,0.35);
    border-top:1px solid var(--ls-glass-border);
  }
  .theme-dark .settings-footer{
    background:rgba(255,255,255,0.03);
    border-top-color:rgba(255,255,255,0.08);
  }

  .settings-loading-mask {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: inherit;
    transition: opacity 0.2s;
    color: #fff;
  }
  .settings-loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  .settings-loading-mask[hidden] {
    display: none !important;
  }
  .settings-loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: settings-spin 1s linear infinite;
  }
  .settings-loading-text {
    font-size: 14px;
    font-weight: 500;
    opacity: 0.9;
  }
  @keyframes settings-spin { to { transform: rotate(360deg); } }

  @media (max-width: 768px){
    .settings-panel{width:calc(100vw - 16px);height:calc(100vh - 16px)}
    .settings-shell{grid-template-columns:1fr;grid-template-rows:auto 1fr}
    .settings-sidebar{flex-direction:row;gap:8px;overflow:auto}
    .settings-tab{min-width:72px;justify-content:center}
    .settings-tab-text{font-size:12px}
    .settings-content-inner{padding:14px}
  }

  @media (max-width: 360px){
    .settings-header{padding:14px 14px 10px}
    .settings-content-inner{padding:12px}
  }
</style>
<div id="settingsModal" class="settings-modal" role="dialog" aria-hidden="true">
  <div class="settings-backdrop"></div>
  <div class="settings-panel settings-gnome settings-hyperos" aria-modal="true" aria-label="设置">
    <div class="settings-header">
      <h3>设置</h3>
      <button id="closeSettings" class="tool-btn">✕</button>
    </div>
    <div class="settings-body settings-body-gnome">
      <div class="settings-shell">
        <div class="settings-sidebar" role="tablist" aria-label="设置分类">
          <button class="settings-tab" type="button" role="tab" id="settingsTab-general" data-tab="general" aria-controls="settingsPanel-general" aria-selected="true" tabindex="0">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M19.14,12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.11-.2-.35-.28-.56-.2l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.03-.22-.22-.38-.44-.38h-3.84c-.22,0-.41.16-.44.38l-.36,2.54c-.59.24-1.13.56-1.62.94l-2.39-.96c-.2-.08-.45,0-.56.2l-1.92,3.32c-.12.2-.07.47.12.61l2.03,1.58c-.05.3-.07.63-.07.94s.02.64.07.94l-2.03,1.58c-.18.14-.23.41-.12.61l1.92,3.32c.11.2.35.28.56.2l2.39-.96c.5.38,1.03.7,1.62.94l.36,2.54c.03.22.22.38.44.38h3.84c.22,0,.41-.16.44-.38l.36-2.54c.59-.24,1.13-.56,1.62-.94l2.39.96c.2.08.45,0,.56-.2l1.92-3.32c.11-.2.06-.47-.12-.61l-2.02-1.58ZM12,15.6c-1.99,0-3.6-1.61-3.6-3.6s1.61-3.6,3.6-3.6,3.6,1.61,3.6,3.6-1.61,3.6-3.6,3.6Z"/></svg>
            <span class="settings-tab-text">常规</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-appearance" data-tab="appearance" aria-controls="settingsPanel-appearance" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 22c4.42 0 8-3.58 8-8c0-1.1-.22-2.14-.62-3.1c-.37-.9-1.41-1.32-2.3-.95l-1.39.57c-.51.21-1.1-.03-1.31-.55l-.57-1.39c-.37-.9-1.41-1.32-2.3-.95l-1.39.57c-.51.21-1.1-.03-1.31-.55l-.57-1.39c-.37-.9-1.41-1.32-2.3-.95C3.24 4.8 2 7.28 2 10c0 6.63 3.37 12 10 12Zm6-8c0 3.31-2.69 6-6 6c-2.89 0-5.45-2.06-6.4-4.98c.35.13.73.2 1.12.2c.59 0 1.16-.11 1.69-.33l1.39-.57l.57 1.39c.37.9 1.41 1.32 2.3.95l1.39-.57l.57 1.39c.37.9 1.41 1.32 2.3.95l1.06-.44c.02.14.02.27.02.41Z"/></svg>
            <span class="settings-tab-text">外观</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-input" data-tab="input" aria-controls="settingsPanel-input" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M7 24c-1.1 0-2-.9-2-2V11c0-1.1.9-2 2-2s2 .9 2 2v11c0 1.1-.9 2-2 2Zm10-11c1.1 0 2-.9 2-2V2c0-1.1-.9-2-2-2s-2 .9-2 2v9c0 1.1.9 2 2 2Zm-5 7c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2s-2 .9-2 2v12c0 1.1.9 2 2 2Z"/></svg>
            <span class="settings-tab-text">输入</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-window" data-tab="window" aria-controls="settingsPanel-window" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 5.75A1.75 1.75 0 0 1 5.75 4h12.5A1.75 1.75 0 0 1 20 5.75v12.5A1.75 1.75 0 0 1 18.25 20H5.75A1.75 1.75 0 0 1 4 18.25ZM5.75 5.5a.25.25 0 0 0-.25.25V9h13V5.75a.25.25 0 0 0-.25-.25Zm-.25 5V18.25a.25.25 0 0 0 .25.25h12.5a.25.25 0 0 0 .25-.25V10.5Z"/></svg>
            <span class="settings-tab-text">窗口</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-shortcuts" data-tab="shortcuts" aria-controls="settingsPanel-shortcuts" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M20 5H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2ZM7 17H5v-2h2v2Zm0-4H5v-2h2v2Zm0-4H5V7h2v2Zm4 8H9v-2h2v2Zm0-4H9v-2h2v2Zm0-4H9V7h2v2Zm4 8h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V7h2v2Zm4 8h-2v-2h2v2Zm0-4h-2v-2h2v2Zm0-4h-2V7h2v2Z"/></svg>
            <span class="settings-tab-text">快捷键</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-toolbar" data-tab="toolbar" aria-controls="settingsPanel-toolbar" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 5.75A1.75 1.75 0 0 1 5.75 4h12.5A1.75 1.75 0 0 1 20 5.75v2.5A1.75 1.75 0 0 1 18.25 10H5.75A1.75 1.75 0 0 1 4 8.25Zm0 8.5A1.75 1.75 0 0 1 5.75 12h7.5A1.75 1.75 0 0 1 15 13.75v4.5A1.75 1.75 0 0 1 13.25 20h-7.5A1.75 1.75 0 0 1 4 18.25Z"/></svg>
            <span class="settings-tab-text">工具栏控件</span>
          </button>
          <button class="settings-tab" type="button" role="tab" id="settingsTab-history" data-tab="history" aria-controls="settingsPanel-history" aria-selected="false" tabindex="-1">
            <svg class="md-icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 8a1 1 0 0 1 1 1v2.585l1.707 1.707a1 1 0 0 1-1.414 1.414l-2-2A1 1 0 0 1 11 12V9a1 1 0 0 1 1-1z"/><path fill="currentColor" d="M12 2a10 10 0 1 1-7.07 2.93l-1.22-1.22a1 1 0 1 1 1.41-1.41l2.63 2.63A1 1 0 0 1 7.05 6.3A8 8 0 1 0 12 4a1 1 0 1 1 0-2z"/></svg>
            <span class="settings-tab-text">历史修改</span>
          </button>
        </div>
        <div class="settings-content" aria-live="polite" aria-busy="false">
          <div class="settings-loading" hidden aria-hidden="true">
            <div class="settings-spinner" aria-hidden="true"></div>
            <div class="settings-loading-text">加载中…</div>
          </div>
          <div class="settings-content-inner">
            <div class="settings-page active" id="settingsPanel-general" data-tab="general" role="tabpanel" aria-labelledby="settingsTab-general">
              <div class="settings-cards">
                <section class="settings-card" aria-label="工具栏">
                  <div class="settings-card-title">工具栏</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optAutoResize"> <span>自动调整工具栏宽度</span></label>
                    <label class="settings-control"><input type="checkbox" id="optCollapsed"> <span>启动时折叠工具栏</span></label>
                    <label class="settings-control"><input type="checkbox" id="optTooltips"> <span>显示工具提示</span></label>
                  </div>
                </section>
                <section class="settings-card" aria-label="应用控制">
                  <div class="settings-card-title">应用控制</div>
                  <div class="settings-card-body">
                    <div class="settings-row">
                      <button id="closeWhiteboardBtnSettings" class="mode-btn mode-btn-danger" type="button">关闭白板</button>
                    </div>
                    <div class="settings-hint">关闭当前白板应用并退出</div>
                  </div>
                </section>
                <section class="settings-card" aria-label="设置预览">
                  <div class="settings-card-title">预览</div>
                  <div class="settings-card-body">
                    <div class="settings-row">
                      <button id="previewSettings" class="mode-btn" type="button">预览设置</button>
                      <button id="revertPreview" class="mode-btn" type="button">撤销预览</button>
                    </div>
                    <div id="historyStateDisplay" class="settings-hint" aria-live="polite">撤销: — 重做: —</div>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-appearance" data-tab="appearance" role="tabpanel" aria-labelledby="settingsTab-appearance" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="主题与样式">
                  <div class="settings-card-title">主题与样式</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">主题</span>
                      <select id="optTheme">
                        <option value="system">跟随系统</option>
                        <option value="light">日间</option>
                        <option value="dark">夜间</option>
                        <option value="high-contrast">高对比度</option>
                        <option value="custom">自定义</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">界面风格</span>
                      <select id="optDesignLanguage">
                        <option value="fluent">Fluent设计风格</option>
                        <option value="material3">Material 3 Expressive设计风格</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">视觉效果</span>
                      <select id="optVisualStyle">
                        <option value="solid">实心</option>
                        <option value="blur">模糊</option>
                        <option value="transparent">透明</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">云母强度 <span id="micaIntensityText">60%</span></span>
                      <input id="optMicaIntensity" type="range" min="0" max="100" step="5" value="60" />
                    </label>
                  </div>
                </section>
                <section class="settings-card" aria-label="自定义主题">
                  <div class="settings-card-title">自定义主题</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">Primary</span>
                      <input type="color" id="optThemePrimary" value="#2B7CFF" aria-label="Primary 颜色">
                    </label>
                    <label class="settings-field">
                      <span class="settings-field-label">Secondary</span>
                      <input type="color" id="optThemeSecondary" value="#535F70" aria-label="Secondary 颜色">
                    </label>
                    <label class="settings-field">
                      <span class="settings-field-label">背景</span>
                      <input type="color" id="optThemeBackground" value="#FFFFFF" aria-label="背景颜色">
                    </label>
                    <div class="settings-divider"></div>
                    <div class="settings-row">
                      <button id="exportThemeBtn" class="mode-btn" type="button">导出 .lantheme</button>
                      <button id="importThemeBtn" class="mode-btn" type="button">导入 .lantheme</button>
                      <button id="resetThemeBtn" class="mode-btn" type="button">重置主题</button>
                      <input id="themeFileInput" type="file" accept=".lantheme,application/json" style="display:none" />
                    </div>
                    <div class="settings-divider"></div>
                    <div class="settings-hint">实时预览</div>
                    <div id="themePreview" class="theme-preview" aria-label="主题预览">
                      <div class="theme-preview-card">
                        <div class="theme-preview-title">示例卡片</div>
                        <div class="theme-preview-body">正文示例文本 16px / 行高 1.5</div>
                        <div class="theme-preview-actions">
                          <button class="mode-btn" type="button">次按钮</button>
                          <button class="md3-button filled" type="button">主按钮</button>
                        </div>
                      </div>
                    </div>
                    <div class="settings-row" style="padding-top:6px">
                      <button id="contrastReportBtn" class="mode-btn" type="button">对比度检查</button>
                      <button id="perfCheckBtn" class="mode-btn" type="button">性能自检</button>
                    </div>
                    <pre id="themeReportOut" class="theme-report" aria-live="polite"></pre>
                  </div>
                </section>
                <section class="settings-card" aria-label="画布">
                  <div class="settings-card-title">画布</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">画布颜色</span>
                      <select id="optCanvasColor">
                        <option value="white">白色</option>
                        <option value="black">黑色</option>
                        <option value="chalkboard">黑板绿</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">PDF默认打开模式</span>
                      <select id="optPdfDefaultMode">
                        <option value="window">窗口模式</option>
                        <option value="fullscreen">全屏模式</option>
                      </select>
                    </label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-input" data-tab="input" role="tabpanel" aria-labelledby="settingsTab-input" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="触控与书写">
                  <div class="settings-card-title">触控与书写</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optMultiTouchPen"> <span>触摸多指书写</span></label>
                    <label class="settings-control"><input type="checkbox" id="optPageSwitchDraggable"> <span>允许拖动页面切换控件</span></label>
                    <label class="settings-control"><input type="checkbox" id="optOverlayShape"> <span>启用窗口裁剪穿透模式（实验性，仅 Windows）</span></label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">批注默认笔颜色</span>
                      <input type="color" id="optAnnotationPenColor" value="#C50F1F" aria-label="批注默认笔颜色">
                    </label>
                  </div>
                </section>
                <section class="settings-card" aria-label="笔锋功能">
                  <div class="settings-card-title">笔锋功能</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optPenTailEnabled"> <span>启用末端采样笔锋</span></label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">参数预设</span>
                      <select id="optPenTailProfile">
                        <option value="standard">标准</option>
                        <option value="calligraphy">书法</option>
                        <option value="speed">速记</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">笔锋强度 <span id="penTailIntensityText">50%</span></span>
                      <input id="optPenTailIntensity" type="range" min="0" max="100" step="1" value="50" aria-label="笔锋强度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">采样点数量 <span id="penTailSamplePointsText">10</span></span>
                      <input id="optPenTailSamplePoints" type="range" min="5" max="20" step="1" value="10" aria-label="采样点数量">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">速度敏感度 <span id="penTailSpeedText">100%</span></span>
                      <input id="optPenTailSpeedSensitivity" type="range" min="0" max="200" step="5" value="100" aria-label="速度敏感度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">压力敏感度 <span id="penTailPressureText">100%</span></span>
                      <input id="optPenTailPressureSensitivity" type="range" min="0" max="200" step="5" value="100" aria-label="压力敏感度">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">笔锋形状</span>
                      <select id="optPenTailShape">
                        <option value="sharp">锐利</option>
                        <option value="round">圆润</option>
                        <option value="natural">自然</option>
                        <option value="custom">自定义</option>
                      </select>
                    </label>
                    <div class="settings-divider"></div>
                    <div class="settings-hint" style="padding-bottom:6px">实时预览</div>
                    <canvas id="penTailPreview" class="pen-tail-preview" width="520" height="150" aria-label="笔锋预览"></canvas>
                  </div>
                </section>
                <section class="settings-card" aria-label="智能功能">
                  <div class="settings-card-title">智能功能</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optSmartInk"> <span>图形与直线智能识别</span></label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-window" data-tab="window" role="tabpanel" aria-labelledby="settingsTab-window" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="窗口">
                  <div class="settings-card-title">窗口</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optSeparateToolbarWindow"> <span>在独立窗口中显示工具栏</span></label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-shortcuts" data-tab="shortcuts" role="tabpanel" aria-labelledby="settingsTab-shortcuts" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="快捷键">
                  <div class="settings-card-title">快捷键</div>
                  <div class="settings-card-body">
                    <label class="settings-field">
                      <span class="settings-field-label">撤销</span>
                      <input id="keyUndo" type="text" placeholder="Ctrl+Z" maxlength="20" inputmode="text" aria-label="撤销快捷键">
                    </label>
                    <div class="settings-divider"></div>
                    <label class="settings-field">
                      <span class="settings-field-label">重做</span>
                      <input id="keyRedo" type="text" placeholder="Ctrl+Y" maxlength="20" inputmode="text" aria-label="重做快捷键">
                    </label>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-toolbar" data-tab="toolbar" role="tabpanel" aria-labelledby="settingsTab-toolbar" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="浮动工具栏控件">
                  <div class="settings-card-title">浮动工具栏控件</div>
                  <div class="settings-card-body">
                    <label class="settings-control"><input type="checkbox" id="optVideoBoothEnabled"> <span>添加到浮动工具栏</span></label>
                    <div class="settings-divider"></div>
                    <div class="resource-layout">
                      <div class="resource-sort">
                        <div class="resource-hint">拖拽排序，点击隐藏/显示按钮，下方实时预览</div>
                        <div id="toolbarLayoutList" class="resource-list" role="list"></div>
                      </div>
                      <div class="resource-preview" aria-label="预览">
                        <div class="resource-preview-title">工具栏预览</div>
                        <div id="toolbarLayoutPreview" class="resource-preview-grid"></div>
                      </div>
                    </div>
                    <div class="settings-row" style="margin-top:8px">
                      <button id="toolbarLayoutReset" class="mode-btn" type="button">恢复默认布局</button>
                    </div>
                  </div>
                </section>
              </div>
            </div>
            <div class="settings-page" id="settingsPanel-history" data-tab="history" role="tabpanel" aria-labelledby="settingsTab-history" hidden>
              <div class="settings-cards">
                <section class="settings-card" aria-label="历史修改">
                  <div class="settings-card-title">历史修改</div>
                  <div class="settings-card-body">
                    <div class="ls-history-toolbar">
                      <button id="historySelectAllBtn" class="mode-btn" type="button">全选</button>
                      <button id="historyUndoSelectedBtn" class="mode-btn" type="button">撤回选中</button>
                      <button id="historyClearBtn" class="mode-btn mode-btn-danger" type="button">清空</button>
                    </div>
                    <div id="settingsHistoryMeta" class="ls-history-meta" aria-live="polite"></div>
                    <div id="settingsHistoryTimeline" class="ls-history-timeline" role="list"></div>
                    <div id="settingsHistoryLoading" class="settings-loading-mask" hidden>
                      <div class="settings-loading-spinner"></div>
                    </div>
                    <div class="ls-history-footer">
                      <button id="historyLoadMoreBtn" class="mode-btn" type="button">加载更多</button>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="settings-footer">
      <button id="resetSettings" class="mode-btn" type="button">重置为默认</button>
      <button id="saveSettings" class="mode-btn mode-btn-primary" type="button">保存</button>
    </div>
  </div>
</div>

<div id="aboutModal" class="settings-modal" role="dialog" aria-hidden="true">
  <div class="settings-backdrop"></div>
  <div class="settings-panel">
    <div class="settings-header">
      <h3>关于</h3>
      <button id="closeAbout" class="tool-btn">✕</button>
    </div>
    <div class="settings-body" style="text-align:center">
      <div style="padding:12px 8px">
        <div style="font-size:18px;font-weight:700">LanStartWrite</div>
        <div style="padding-top:6px;color:#555">揽星书写</div>
        <div style="padding-top:12px;font-size:14px;color:#888">版本 0.2.1</div>
        <div style="padding-top:4px;font-size:14px;color:#888">Doctor</div>
      </div>
    </div>
  </div>
</div>

<div id="pluginModal" class="settings-modal" role="dialog" aria-hidden="true" aria-label="插件管理">
  <div class="settings-backdrop"></div>
  <div class="settings-panel plugin-panel">
    <div class="settings-header">
      <h3>插件管理</h3>
      <button id="closePluginModal" class="tool-btn" aria-label="关闭">✕</button>
    </div>
    <div class="settings-body plugin-body">
      <div class="plugin-install-row">
        <input id="pluginFileInput" type="file" accept=".lanmod" style="display:none" />
        <button id="pluginInstallBtn" class="mode-btn">安装插件</button>
        <button id="pluginRefreshBtn" class="mode-btn">刷新</button>
        <div id="pluginInstallStatus" class="plugin-status" aria-live="polite"></div>
      </div>
      <div id="pluginDropZone" class="plugin-drop" tabindex="0" role="button" aria-label="拖放或选择插件安装">
        <div class="plugin-drop-title">拖放 .lanmod 到这里安装</div>
        <div class="plugin-drop-sub">或点击“安装插件”选择文件</div>
        <progress id="pluginInstallProgress" value="0" max="100" class="plugin-progress" aria-label="安装进度"></progress>
      </div>
      <div class="plugin-list-head">
        <div>已安装插件</div>
        <div class="plugin-list-hint">拖动排序</div>
      </div>
      <div id="pluginList" class="plugin-list" role="list"></div>
    </div>
  </div>
</div>
